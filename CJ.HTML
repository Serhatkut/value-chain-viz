<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DHL eCommerce Â· Value Chain Blueprint</title>
  <link href="https://fonts.googleapis.com/css2?family=Delivery:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================
       DHL THEME VARIABLES
       ========================= */
    :root {
      --dhl-red: #D40511;
      --dhl-yellow: #FFCC00;
      --dhl-black: #101828;
      
      --bg: #F2F4F7;
      --surface: #FFFFFF;
      --border: #E4E7EC;
      
      --head-h: 64px;
      --lane-w: 240px;
      --col-min: 200px;
      
      /* Bottom Deck Height */
      --deck-h: 340px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--dhl-black);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* =========================
       HEADER
       ========================= */
    header {
      height: var(--head-h);
      background: var(--dhl-red);
      color: white;
      display: flex;
      align-items: center;
      padding: 0 24px;
      justify-content: space-between;
      flex-shrink: 0;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .brand { font-family: 'Delivery', sans-serif; font-weight: 900; font-size: 22px; display: flex; align-items: center; gap: 12px; }
    .brand span { background: var(--dhl-yellow); color: var(--dhl-red); padding: 2px 8px; border-radius: 4px; font-size: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    
    .legend { display: flex; gap: 20px; font-size: 11px; font-weight: 600; }
    .legend-item { display: flex; align-items: center; gap: 6px; color: white; }
    .dot { width: 10px; height: 10px; border-radius: 2px; background: white; }

    /* =========================
       MAIN GRID (TOP HALF)
       ========================= */
    .grid-wrapper {
      flex: 1;
      overflow: auto;
      display: grid;
      /* Lane Header + 7 Stages */
      grid-template-columns: var(--lane-w) repeat(7, minmax(var(--col-min), 1fr)); 
      /* Explicit Rows */
      grid-template-rows: auto auto auto auto auto auto auto auto;
      background: var(--bg);
      padding-bottom: var(--deck-h); 
    }

    /* Sticky Corner */
    .corner-plate {
      position: sticky; top: 0; left: 0; z-index: 60;
      background: var(--surface); 
      border-right: 1px solid var(--border);
      border-bottom: 4px solid var(--dhl-red);
      display: flex; align-items: center; justify-content: center;
      padding: 10px; grid-row: 1; grid-column: 1;
    }
    .cp-title { font-weight: 900; font-size: 13px; color: var(--dhl-red); text-transform: uppercase; text-align: center; }

    /* Stage Headers */
    .stage-head {
      position: sticky; top: 0; z-index: 50;
      background: var(--surface); 
      border-right: 1px solid var(--border);
      border-bottom: 4px solid var(--dhl-red);
      padding: 12px 16px; display: flex; flex-direction: column; gap: 4px;
      grid-row: 1;
    }
    .stage-voice { font-family: 'Delivery', sans-serif; font-size: 13px; font-weight: 900; color: var(--dhl-black); font-style: italic; }
    .stage-meta { font-size: 10px; font-weight: 700; color: #94A3B8; text-transform: uppercase; }

    /* Lane Labels */
    .lane-label {
      position: sticky; left: 0; z-index: 40;
      background: var(--surface);
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 20px; display: flex; flex-direction: column; justify-content: center;
    }
    .lane-title { font-size: 14px; font-weight: 800; color: var(--dhl-black); margin-bottom: 4px; }
    .lane-desc { font-size: 10px; color: #64748B; line-height: 1.3; }
    
    /* Row Backgrounds */
    .lane-comm { border-left: 6px solid var(--dhl-yellow); background:#FFFBEB; }
    .lane-ops { border-left: 6px solid var(--dhl-red); background:#FEF2F2; }
    .lane-cont { border-left: 6px solid #2563EB; background:#EFF6FF; }
    .lane-found { border-left: 6px solid #475569; background:#F8FAFC; }

    /* Cells */
    .cell {
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 10px; display: flex; flex-direction: column; gap: 8px;
      min-height: 140px; background: white;
    }
    .cell-cont { background: #EFF6FF; min-height: 80px; justify-content: center; }
    .cell-found { background: #F8FAFC; }

    /* =========================
       PROCESS TILES (CHEVRON STYLE)
       ========================= */
    .tile {
      background: white;
      border: 1px solid #CBD5E1;
      border-left: 4px solid #ccc;
      /* Chevron Shape */
      clip-path: polygon(0% 0%, 95% 0%, 100% 50%, 95% 100%, 0% 100%);
      padding: 8px 16px 8px 10px; 
      cursor: pointer;
      position: relative;
      transition: all 0.15s ease;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      margin-right: -5px; /* Overlap flow */
    }
    .tile:hover {
      transform: translateX(3px);
      background: #FFF7ED;
      border-color: var(--dhl-red);
      z-index: 10;
    }
    
    /* Spanning Tiles (Continuous) */
    .tile-span {
      height: 36px; display: flex; align-items: center; justify-content: center; gap: 10px;
      background: white; border: 1px solid #93C5FD; border-left: 5px solid #2563EB;
      box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1);
      width: 98%; margin: 0 auto;
      /* Flat arrow */
      clip-path: polygon(0% 0%, 98% 0%, 100% 50%, 98% 100%, 0% 100%);
    }
    .tile-span:hover { background: #EFF6FF; transform: scale(1.01); border-color: #2563EB; }
    .tile-span .t-name { font-size: 11px; font-weight: 800; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Tile Content */
    .t-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
    .t-id { font-size: 10px; font-weight: 800; color: #64748B; }
    .t-name { font-size: 11px; font-weight: 700; color: #0F172A; line-height: 1.2; }

    /* L0 Specific Colors */
    .c-L2C { border-left-color: var(--dhl-yellow); }
    .c-O2D { border-left-color: var(--dhl-red); }
    .c-P2R { border-left-color: #F97316; }
    .c-ITF { border-left-color: #7C3AED; }
    .c-D2O { border-left-color: #475569; }

    /* =========================
       BOTTOM DECK (DETAIL VIEW)
       ========================= */
    #deck {
      position: fixed; bottom: 0; left: 0; width: 100%; height: var(--deck-h);
      background: white; border-top: 4px solid var(--dhl-red);
      z-index: 200; box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
      display: flex; flex-direction: column;
      transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    #deck.open { transform: translateY(0); }

    .deck-header {
      padding: 10px 24px; background: #F8FAFC; border-bottom: 1px solid #E2E8F0;
      display: flex; justify-content: space-between; align-items: center;
    }
    .deck-title { font-size: 16px; font-weight: 800; color: var(--dhl-black); text-transform: uppercase; }
    .deck-meta { font-size: 11px; color: #64748B; display: flex; gap: 16px; }
    
    .deck-body {
      flex: 1; padding: 20px 24px; overflow-x: auto; 
      display: flex; gap: 16px; align-items: flex-start;
      background: #FFFFFF;
    }

    /* L2/L3 Cards */
    .l2-col {
      min-width: 240px; max-width: 260px;
      background: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 6px;
      display: flex; flex-direction: column;
      flex-shrink: 0;
    }
    .l2-head {
      padding: 8px 10px; background: #FFF; border-bottom: 2px solid var(--dhl-yellow);
      display: flex; justify-content: space-between; align-items: center;
      border-radius: 6px 6px 0 0;
    }
    .l2-id { font-size: 9px; font-weight: 800; color: #94A3B8; }
    .l2-name { font-size: 11px; font-weight: 700; color: #0F172A; }

    .l3-list { padding: 8px; display: flex; flex-direction: column; gap: 4px; }
    .l3-item {
      font-size: 10px; padding: 4px 6px; background: white; border: 1px solid #E2E8F0; border-radius: 4px;
      color: #334155; display: flex; flex-direction: column; gap: 2px;
    }
    .l3-row { display: flex; justify-content: space-between; }
    .l3-id { font-weight: 800; color: var(--dhl-red); font-size: 9px; }

    .close-btn { 
      background: #E2E8F0; border: none; padding: 6px 12px; border-radius: 4px; 
      font-size: 11px; font-weight: 700; cursor: pointer; color: #475569;
    }
    .close-btn:hover { background: #CBD5E1; color: #0F172A; }

    .deck-empty { padding: 40px; text-align: center; color: #94A3B8; font-style: italic; width: 100%; }

  </style>
</head>
<body>

<header>
  <div class="brand"><span>DHL</span> eCommerce Blueprint</div>
  <div class="legend">
    <div class="legend-item"><div class="dot" style="background:var(--dhl-yellow)"></div> Commercial</div>
    <div class="legend-item"><div class="dot" style="background:var(--dhl-red)"></div> Operations</div>
    <div class="legend-item"><div class="dot" style="background:#2563EB"></div> Visibility</div>
    <div class="legend-item"><div class="dot" style="background:#475569"></div> Foundation</div>
  </div>
</header>

<div class="grid-wrapper" id="grid">
  </div>

<div id="deck">
  <div class="deck-header">
    <div>
      <div style="font-size:10px; font-weight:700; color:#94A3B8; margin-bottom:2px">SELECTED PROCESS DETAIL</div>
      <div class="deck-title" id="d_title">Select a Process</div>
    </div>
    <div class="deck-meta">
      <span id="d_id">ID: -</span>
      <span id="d_owner">Owner: -</span>
    </div>
    <button class="close-btn" onclick="closeDeck()">CLOSE PANEL</button>
  </div>
  <div class="deck-body" id="d_body">
    <div class="deck-empty">Click any chevron tile above to see Process IDs (L2) & Activities (L3).</div>
  </div>
</div>

<script>
  // ==========================================
  // 1. DATA MODEL (Mock Data for Demo)
  // ==========================================
  // In production, this would be replaced by fetch('data.json')
  const MOCK_DATA = [
    { id: "L2C_01", name: "Market Analysis", owner: "Strategy", children: [
        { id: "L2C_01_01", name: "Competitor Scan", children: [{id:"L3_01", name:"Data Collection"}, {id:"L3_02", name:"SWOT Analysis"}] }
    ]},
    { id: "L2C_02", name: "Pricing & Quote", owner: "Sales", children: [
        { id: "L2C_02_01", name: "Rate Calculation", children: [{id:"L3_03", name:"Lookup Base Rate"}, {id:"L3_04", name:"Apply Surcharge"}] }
    ]},
    { id: "L2C_04", name: "Customer Onboarding", owner: "CS", children: [
        { id: "L2C_04_01", name: "Account Setup", children: [{id:"L3_05", name:"Create SAP ID"}, {id:"L3_06", name:"Config Web Portal"}] },
        { id: "L2C_04_02", name: "IT Integration", children: [{id:"L3_07", name:"API Keys Gen"}, {id:"L3_08", name:"Label Test"}] }
    ]},
    { id: "L2C_08", name: "Track & Trace", owner: "IT/Ops", children: [
        { id: "L2C_08_01", name: "Event Ingestion", children: [{id:"L3_09", name:"Receive Scan"}, {id:"L3_10", name:"Normalize Data"}] },
        { id: "L2C_08_02", name: "Cust Notification", children: [{id:"L3_11", name:"Send Email"}, {id:"L3_12", name:"Push App Notif"}] }
    ]},
    { id: "O2D_04", name: "Linehaul Ops", owner: "Network", children: [
        { id: "O2D_04_01", name: "Load Planning", children: [{id:"L3_13", name:"Check Volume"}, {id:"L3_14", name:"Assign Truck"}] },
        { id: "O2D_04_02", name: "Dispatch", children: [{id:"L3_15", name:"Verify Seal"}, {id:"L3_16", name:"Gate Out"}] }
    ]},
    { id: "P2R_01", name: "Incident Mgmt", owner: "CS/Ops", children: [
        { id: "P2R_01_01", name: "Detection", children: [{id:"L3_17", name:"Monitor Exception"}, {id:"L3_18", name:"Alert Team"}] },
        { id: "P2R_01_02", name: "Resolution", children: [{id:"L3_19", name:"Re-route Parcel"}, {id:"L3_20", name:"Notify Sender"}] }
    ]}
  ];

  // ==========================================
  // 2. CONFIGURATION
  // ==========================================
  const STAGES = [
    { id: "S1", name: "Awareness & Plan", num: "01", voice: "I discover" },
    { id: "S2", name: "Offer & Account",  num: "02", voice: "I agree" },
    { id: "S3", name: "Onboarding",       num: "03", voice: "I integrate" }, // Highlighted
    { id: "S4", name: "Booking & Collect",num: "04", voice: "I ship" },
    { id: "S5", name: "Export & Transit", num: "05", voice: "It moves" },
    { id: "S6", name: "Delivery",         num: "06", voice: "I receive" },
    { id: "S7", name: "Post-Shipment",    num: "07", voice: "I pay/return" }
  ];

  const ROWS = [
    { id: "COMM", name: "Commercial", desc: "L2C (Lead to Cash)", class: "lane-comm" },
    { id: "OPS", name: "Operations", desc: "O2D (Order to Del)", class: "lane-ops" },
    { id: "CONT_VIS", name: "Visibility", desc: "Track & Trace", class: "lane-cont" },
    { id: "CONT_RES", name: "Resolution", desc: "P2R (Issue Mgmt)", class: "lane-cont" },
    { id: "DESIGN", name: "Design", desc: "D2O (Design)", class: "lane-found" },
    { id: "RES", name: "Resources", desc: "S2P & H2R", class: "lane-found" },
    { id: "FOUND", name: "Foundation", desc: "Strategy & IT", class: "lane-found" }
  ];

  // MAPPING: Placing Tiles into the Grid
  const TILES = [
    // --- STAGE 1: PLAN ---
    { id: "S2E_01", stage: 1, row: "FOUND", label: "Strategy" },
    { id: "L2C_01", stage: 1, row: "COMM", label: "Marketing" },
    { id: "D2O_01", stage: 1, row: "DESIGN", label: "Market Analysis" },

    // --- STAGE 2: OFFER ---
    { id: "L2C_02", stage: 2, row: "COMM", label: "Pricing" },
    { id: "L2C_03", stage: 2, row: "COMM", label: "Contract" },
    { id: "R2R_04", stage: 2, row: "FOUND", label: "Credit Check" },

    // --- STAGE 3: ONBOARDING ---
    { id: "L2C_04", stage: 3, row: "COMM", label: "Account Setup" },
    { id: "ITF_04", stage: 3, row: "FOUND", label: "API Integration" },
    { id: "D2O_02", stage: 3, row: "DESIGN", label: "Product Config" },

    // --- STAGE 4: BOOKING ---
    { id: "L2C_05", stage: 4, row: "COMM", label: "Booking" },
    { id: "O2D_01", stage: 4, row: "OPS", label: "Data Entry" },
    { id: "O2D_02", stage: 4, row: "OPS", label: "Pickup" },

    // --- STAGE 5: TRANSIT ---
    { id: "O2D_03", stage: 5, row: "OPS", label: "Sort Origin" },
    { id: "O2D_04", stage: 5, row: "OPS", label: "Linehaul" },
    { id: "O2D_07", stage: 5, row: "OPS", label: "Export" },

    // --- STAGE 6: DELIVERY ---
    { id: "O2D_08", stage: 6, row: "OPS", label: "Import" },
    { id: "O2D_10", stage: 6, row: "OPS", label: "Last Mile" },
    { id: "ITF_02", stage: 6, row: "FOUND", label: "Driver App" },

    // --- STAGE 7: POST ---
    { id: "L2C_06", stage: 7, row: "COMM", label: "Invoice" },
    { id: "O2D_12", stage: 7, row: "OPS", label: "Returns" },
    { id: "P2R_03", stage: 7, row: "COMM", label: "Claims" },

    // CONTINUOUS STREAMS (Spanning)
    { id: "L2C_08", stage: 3, row: "CONT_VIS", span: 5, label: "L2C_08: End-to-End Visibility (Tracking)" },
    { id: "P2R_01", stage: 4, row: "CONT_RES", span: 4, label: "P2R_01: Network Issue Resolution" },
    
    // RESOURCES ROW (Example Chevrons)
    { id: "S2P_01", stage: 1, row: "RES", label: "Sourcing" },
    { id: "H2R_01", stage: 2, row: "RES", label: "Hiring" },
    { id: "H2R_02", stage: 5, row: "RES", label: "Workforce" }
  ];

  let INDEX = new Map();

  async function init() {
    renderGrid();
    try {
      // Try to fetch real data, fall back to mock if fails
      const res = await fetch("data.json");
      if(res.ok) {
        const root = await res.json();
        buildIndex(root);
      } else {
        console.warn("data.json not found, using mock data");
        buildMockIndex();
      }
    } catch(e) { 
      console.warn("Fetch failed, using mock data", e);
      buildMockIndex();
    }
    hydrateTiles();
  }

  function buildIndex(node) {
    if(node.id) INDEX.set(node.id, node);
    if(node.children) node.children.forEach(buildIndex);
  }
  
  function buildMockIndex() {
    // Flatten the mock array into the map for easy lookup
    MOCK_DATA.forEach(node => INDEX.set(node.id, node));
  }

  function renderGrid() {
    const grid = document.getElementById('grid');
    
    // 1. Corner
    const corner = document.createElement('div');
    corner.className = 'corner-plate';
    corner.innerHTML = `<div class="cp-title">Value Chain<br>Map</div>`;
    grid.appendChild(corner);

    // 2. Stage Headers
    STAGES.forEach(s => {
      const h = document.createElement('div');
      h.className = 'stage-head';
      h.style.gridColumn = parseInt(s.num) + 1; // +1 for label col
      h.innerHTML = `
        <div class="stage-meta">Step ${s.num}</div>
        <div class="stage-voice">"${s.voice}"</div>
        <div style="font-size:12px; font-weight:800; color:#111; margin-top:2px">${s.name}</div>
      `;
      grid.appendChild(h);
    });

    // 3. Rows & Cells
    ROWS.forEach((r, rIdx) => {
       const rowNum = rIdx + 2; // +2 offset

       // Row Label
       const lab = document.createElement('div');
       lab.className = `lane-label ${r.class}`;
       lab.style.gridRow = rowNum;
       lab.style.gridColumn = 1;
       lab.innerHTML = `<div class="lane-title">${r.name}</div><div class="lane-desc">${r.desc}</div>`;
       grid.appendChild(lab);

       // Cells for each Stage
       STAGES.forEach((s, sIdx) => {
         const cell = document.createElement('div');
         cell.className = `cell ${r.id === 'FOUND' ? 'cell-found' : ''}`;
         if(r.id.startsWith('CONT')) cell.classList.add('cell-cont');
         
         cell.style.gridRow = rowNum;
         cell.style.gridColumn = sIdx + 2; 
         cell.id = `cell_${r.id}_${sIdx+1}`; 
         grid.appendChild(cell);
       });
    });
  }

  function hydrateTiles() {
    TILES.forEach(t => {
      const node = INDEX.get(t.id);
      const name = t.label || (node ? (node.name.includes(':') ? node.name.split(':')[1].trim() : node.name) : t.id);
      const l0 = t.id.split('_')[0];
      
      const el = document.createElement('div');
      el.onclick = () => openDeck(t.id, name);
      
      if(t.span) {
        // Continuous Stream Item
        el.className = `tile-span c-${l0}`;
        el.innerHTML = `<span class="t-name">${name}</span>`;
        
        const rIdx = ROWS.findIndex(r => r.id === t.row) + 2;
        const cStart = t.stage + 1;
        const cEnd = cStart + t.span;
        
        el.style.gridRow = rIdx;
        el.style.gridColumn = `${cStart} / ${cEnd}`;
        el.style.alignSelf = "center";
        el.style.zIndex = 10;
        
        document.getElementById('grid').appendChild(el); 
        
      } else {
        // Standard Tile
        el.className = `tile c-${l0}`;
        el.innerHTML = `
          <div class="t-head"><span class="t-id">${t.id}</span></div>
          <div class="t-name">${name}</div>
        `;
        document.getElementById(`cell_${t.row}_${t.stage}`).appendChild(el);
      }
    });
  }

  function openDeck(id, name) {
    const node = INDEX.get(id);
    document.getElementById('d_title').textContent = name;
    document.getElementById('d_id').textContent = "ID: " + id;
    document.getElementById('d_owner').textContent = "Owner: " + (node ? (node.owner || "TBD") : "TBD");
    
    const body = document.getElementById('d_body');
    body.innerHTML = "";

    if(!node || !node.children || node.children.length === 0) {
      body.innerHTML = `<div class="deck-empty">No sub-processes found in data.json for this item.</div>`;
    } else {
      // Render Columns
      node.children.forEach(l2 => {
        const col = document.createElement('div');
        col.className = 'l2-col';
        const l2Name = l2.name.includes(':') ? l2.name.split(':')[1].trim() : l2.name;
        
        let l3HTML = "";
        if(l2.children && l2.children.length > 0) {
           l2.children.forEach(l3 => {
             const l3Name = l3.name.includes(':') ? l3.name.split(':')[1].trim() : l3.name;
             l3HTML += `
               <div class="l3-item">
                 <div class="l3-row"><span class="l3-id">${l3.id}</span></div>
                 <div>${l3Name}</div>
               </div>`;
           });
        } else {
           l3HTML = `<div class="l3-item" style="color:#ccc; font-style:italic">No L3 activities</div>`;
        }

        col.innerHTML = `
          <div class="l2-head">
            <span class="l2-name">${l2Name}</span>
            <span class="l2-id">${l2.id}</span>
          </div>
          <div class="l3-list">${l3HTML}</div>
        `;
        body.appendChild(col);
      });
    }

    document.getElementById('deck').classList.add('open');
  }

  function closeDeck() {
    document.getElementById('deck').classList.remove('open');
  }

  init();
</script>
</body>
</html>