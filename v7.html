<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DHL eCommerce ¬∑ Value Chain ¬∑ Master Map</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    /* =========================
       BRAND TOKENS (DO NOT CHANGE)
       ========================= */
    :root{
      --dhl-red:#D40511;
      --dhl-yellow:#FFCC00;

      /* UI neutrals */
      --bg:#f2f4f8;
      --card:#ffffff;
      --ink:#101828;
      --muted:#667085;
      --line:#e6e8ee;

      /* L2 sizing: SMALL is now permanent */
      --l2-scale: 0.60;                  /* fixed (S) */
      --l2-base-w: 320px;
      --l2-w: calc(var(--l2-base-w) * var(--l2-scale));
      --l2-minw: var(--l2-w);
      --l2-notch: 35px;
      --l2-overlap: -14px;

      /* Equal height chevrons */
      --l2-fixed-h: 520px;

      /* L2 shading + hover shading */
      --l2-bg: #f0f0f0;                  /* light gray */
      --l2-bg-hover: #fff4cc;            /* light yellow on hover */

      /* L2 outline */
      --l2-border: rgba(212,5,17,0.18);

      /* Footer */
      --footer-h: 26px;
    }

    /* --- LAYOUT RESET --- */
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: var(--bg);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      color: var(--ink);
    }

    /* --- SCROLLBAR STYLING --- */
    ::-webkit-scrollbar{ width: 14px; height: 14px; }
    ::-webkit-scrollbar-track{ background: #e0e0e0; border-left: 1px solid #ccc; }
    ::-webkit-scrollbar-thumb{ background: #bbb; border-radius: 7px; border: 3px solid #e0e0e0; }
    ::-webkit-scrollbar-thumb:hover{ background: #999; }

    /* --- HEADER --- */
    #app-header{
      background-color: var(--dhl-red);
      color: #fff;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: 900;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      flex-shrink: 0;
      z-index: 200;
    }
    #header-left{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 280px;
      white-space: nowrap;
    }
    #header-right{
      display:flex;
      align-items:center;
      gap: 10px;
    }
    #version-pill{
      font-size: 12px;
      font-weight: 900;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(0,0,0,0.14);
      white-space: nowrap;
    }

    /* --- BREADCRUMB BAR (REPLACES FILTERS) --- */
    #breadcrumb-bar{
      background: #fff;
      border-bottom: 1px solid #ddd;
      padding: 8px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
      min-height: 40px;
    }

    .crumb-toggle{
      display:flex;
      align-items:center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.10);
      background: #f7f7f8;
      font-size: 12px;
      font-weight: 900;
      color: #333;
    }
    .crumb-toggle:hover{ background:#eceef3; }
    .crumb-house{
      font-size: 15px;
      line-height: 1;
    }

    .crumbs{
      display:flex;
      align-items:center;
      flex-wrap: wrap;
      gap: 8px;
      min-width: 0;
    }

    .crumb{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      font-size: 12px;
      font-weight: 900;
      white-space: nowrap;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.08);
      background: #fafafa;
      max-width: 52vw;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .crumb .cid{
      opacity: 0.95;
      font-weight: 1000;
    }
    .crumb .cname{
      opacity: 0.92;
      font-weight: 800;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .sep{
      opacity: 0.35;
      font-weight: 900;
    }

    /* Breadcrumb text colors by level */
    .crumb.l0{ color: var(--dhl-red); }
    .crumb.l1{ color: var(--dhl-yellow); background: #fffdf2; border-color: rgba(255,204,0,0.35); }
    .crumb.l2{ color: #333; }
    .crumb.l3{ color: #9aa0a6; }

    /* --- MINI NAV --- */
    #mini-nav{
      background: #333;
      color: #fff;
      padding: 10px 25px;
      display: none;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      border-bottom: 3px solid var(--dhl-yellow);
      flex-shrink: 0;
    }
    #mini-nav:hover{ background: #444; }

    /* --- STRATEGY HOUSE (L0) --- */
    #strategy-house-container{
      background: #eef1f5;
      padding: 25px;
      transition: all 0.5s ease-in-out;
      max-height: 800px;
      opacity: 1;
      overflow: hidden;
      border-bottom: 1px solid #ccc;
      flex-shrink: 0;
    }
    #strategy-house-container.collapsed{
      max-height: 0;
      padding: 0 25px;
      opacity: 0;
      border-bottom-width: 0;
    }

    .house-grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      max-width: 1100px;
      margin: auto;
      filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
    }
    .house-section{ padding: 20px; position: relative; display: flex; flex-direction: column; }
    .house-title{ text-align: center; text-transform: uppercase; font-size: 13px; font-weight: 900; letter-spacing: 1px; margin-bottom: 15px; }
    .btn-container{ display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }

    #house-roof{
      grid-column: 1 / span 2;
      background: var(--dhl-red);
      color: white;
      clip-path: polygon(50% 0%, 100% 25%, 100% 100%, 0% 100%, 0% 25%);
      padding-top: 40px;
      margin-bottom: -5px;
      z-index: 2;
    }
    #house-pillar-run{ background: var(--dhl-yellow); color: var(--dhl-red); border: 1px solid rgba(0,0,0,0.05); }
    #house-pillar-transform{ background: #333; color: #fff; }
    #house-foundation{ grid-column: 1 / span 2; background: #d0d0d0; color: #333; border-radius: 0 0 8px 8px; border-top: 4px solid #bbb; }

    .l0-btn{
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      text-align: left;
      min-width: 140px;
      flex-grow: 1;
      max-width: 220px;
      transition: transform 0.2s;
      position: relative;
    }
    .l0-btn:hover{ transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .l0-btn-id{ font-size: 10px; font-weight: 900; display: block; opacity: 0.85; }
    .l0-btn-name{ font-size: 13px; font-weight: 800; line-height: 1.1; }

    #house-roof .l0-btn{ background: rgba(255,255,255,0.2); color: #fff; }
    #house-roof .l0-btn:hover{ background: #fff; color: var(--dhl-red); }
    #house-roof .l0-btn.active{ background: #fff; color: var(--dhl-red); box-shadow: 0 0 0 2px var(--dhl-yellow); }

    #house-pillar-run .l0-btn{ background: rgba(255,255,255,0.6); color: #000; }
    #house-pillar-run .l0-btn:hover{ background: #fff; color: var(--dhl-red); }
    #house-pillar-run .l0-btn.active{ background: var(--dhl-red); color: #fff; }

    #house-pillar-transform .l0-btn{ background: rgba(255,255,255,0.15); color: #ddd; }
    #house-pillar-transform .l0-btn:hover{ background: #fff; color: #333; }
    #house-pillar-transform .l0-btn.active{ background: var(--dhl-yellow); color: #000; }

    #house-foundation .l0-btn{ background: #fff; color: #333; }
    #house-foundation .l0-btn:hover{ background: #333; color: #fff; }
    #house-foundation .l0-btn.active{ background: var(--dhl-red); color: #fff; }

    /* --- CONTEXT BAR --- */
    #context-bar{
      background: #fff;
      border-bottom: 1px solid #ddd;
      padding: 10px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      height: 50px;
    }
    #ctx-title{ margin: 0; font-size: 18px; color: #333; font-weight: 900; }
    #ctx-desc{
      font-size: 14px; color: #666; margin-left: 20px;
      border-left: 3px solid var(--dhl-yellow);
      padding-left: 15px;
    }
    #ctx-owner{ font-size: 11px; color: #fff; background: #333; padding: 4px 10px; border-radius: 4px; font-weight: 900; }

    /* --- L1 CHEVRONS --- */
    #l1-container{
      padding: 15px 30px;
      background: #fdfdfd;
      border-bottom: 1px solid #ddd;
      display: flex;
      flex-wrap: wrap;
      flex-shrink: 0;
      min-height: 80px;
    }
    .l1-chevron{
      position: relative;
      background: #e0e0e0;
      height: 60px;
      width: 170px;
      margin-right: 6px;
      margin-bottom: 6px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-left: 28px;
      padding-right: 15px;
      cursor: pointer;
      transition: all 0.1s;
      color: #333;
      user-select: none;
      clip-path: polygon(0% 0%, calc(100% - 15px) 0%, 100% 50%, calc(100% - 15px) 100%, 0% 100%, 15px 50%);
    }
    .l1-chevron.first{
      clip-path: polygon(0% 0%, calc(100% - 15px) 0%, 100% 50%, calc(100% - 15px) 100%, 0% 100%);
      padding-left: 15px;
    }

    /* Requirement: L1 chevron shapes must be DHL Yellow (arrows/indicators) */
    .l1-chevron{ background: var(--dhl-yellow); }
    .l1-chevron:hover{ filter: brightness(0.95); transform: translateY(-2px); }
    .l1-chevron.active{ background: var(--dhl-red); color: #fff; }
    .l1-chevron.active .l1-id{ color: var(--dhl-yellow); }

    .l1-id{ font-size: 11px; font-weight: 1000; color: var(--dhl-red); margin-bottom: 2px; }
    .l1-name{ font-size: 12px; font-weight: 900; line-height: 1.1; }

    /* --- WORKSPACE (L2/L3) --- */
    #workspace{
      flex-grow: 1;
      padding: 32px 30px;
      overflow-x: auto;
      overflow-y: hidden;
      background: #fff;
      display: flex;
      align-items: flex-start;
      white-space: nowrap;
      padding-bottom: calc(40px + var(--footer-h));
    }

    /* --- L2 CHEVRONS --- */
    .l2-chain-item{
      position: relative;
      width: var(--l2-w);
      min-width: var(--l2-minw);
      margin-left: var(--l2-overlap);

      height: var(--l2-fixed-h);
      min-height: var(--l2-fixed-h);

      clip-path: polygon(
        0% 0%,
        calc(100% - var(--l2-notch)) 0%,
        100% 50%,
        calc(100% - var(--l2-notch)) 100%,
        0% 100%,
        var(--l2-notch) 50%
      );

      background: var(--l2-bg);

      filter:
        drop-shadow(0 0 0.8px rgba(0,0,0,0.45))
        drop-shadow(0 10px 18px rgba(0,0,0,0.12));

      padding: 22px 18px 16px 40px;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s, z-index 0s, filter 0.2s, background 0.15s;
    }

    .l2-chain-item::before{
      content:"";
      position:absolute;
      inset:0;
      clip-path: inherit;
      pointer-events:none;
      border: 2px solid var(--l2-border);
      box-shadow: inset 0 0 0 1px rgba(255,204,0,0.18);
    }

    .l2-chain-item.first{
      margin-left: 0;
      clip-path: polygon(0% 0%, calc(100% - var(--l2-notch)) 0%, 100% 50%, calc(100% - var(--l2-notch)) 100%, 0% 100%);
      padding-left: 22px;
    }

    .l2-chain-item:hover{
      background: var(--l2-bg-hover);
      z-index: 100;
      transform: scale(1.01);
      filter:
        drop-shadow(0 0 1px rgba(212,5,17,0.45))
        drop-shadow(0 14px 24px rgba(0,0,0,0.16));
    }

    .l2-bar{ height: 4px; background: var(--dhl-yellow); width: 100%; margin-bottom: 10px; border-radius: 2px; flex: 0 0 auto; }
    .l2-id{ color: var(--dhl-red); font-size: 11px; font-weight: 1000; display: block; margin-bottom: 4px; flex: 0 0 auto; }

    /* Requirement: L2 title fixed height (reserve 2 rows) + slightly smaller font */
    .l2-name{
      color: #222;
      font-size: 13px;            /* slightly reduced */
      font-weight: 1000;
      white-space: normal;
      line-height: 1.20;
      margin-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      padding-bottom: 10px;

      /* Reserve exactly 2 lines of space */
      height: calc(1.20em * 2);
      overflow: hidden;

      flex: 0 0 auto;
    }

    /* L3 list scrolls inside chevron */
    .l3-list{
      flex: 1 1 auto;
      overflow-y: auto;
      padding-right: 10px;
      min-height: 0;
    }

    .l3-item{
      background: #fff;
      margin-bottom: 6px;
      padding: 8px 10px;
      border-radius: 4px;
      border-left: 3px solid #ccc;
      font-size: 12px;
      white-space: normal;
      cursor: help;
      transition: all 0.1s;
    }
    .l3-item:hover{ border-left-color: var(--dhl-red); background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .l3-head{ display: flex; justify-content: space-between; margin-bottom: 2px; font-size: 10px; color: #999; text-transform: uppercase; font-weight: 900; }
    .l3-body{ color: #333; font-weight: 600; }

    /* --- TOOLTIP & ERROR --- */
    #tooltip{
      position: fixed;
      display: none;
      background: #222;
      color: #fff;
      padding: 12px 16px;
      border-radius: 4px;
      font-size: 12px;
      max-width: 280px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      z-index: 1000;
      pointer-events: none;
      border-left: 4px solid var(--dhl-yellow);
    }
    #tooltip h4{ margin: 0 0 6px 0; color: var(--dhl-yellow); font-size: 13px; }
    #tooltip p{ margin: 0 0 8px 0; color: #ddd; line-height: 1.4; }
    #tooltip .meta{ border-top: 1px solid #444; padding-top: 8px; color: #aaa; font-size: 11px; }
    #error-msg{ display: none; padding: 50px; text-align: center; color: red; background: white; }

    /* --- FOOTER --- */
    #app-footer{
      height: var(--footer-h);
      flex-shrink: 0;
      background: transparent;
      color: rgba(0,0,0,0.55);
      font-size: 10px;
      font-weight: 700;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 0 12px;
      border-top: 1px solid rgba(0,0,0,0.06);
    }
  </style>
</head>

<body>
  <div id="app-header">
    <div id="header-left">
      <span>DHL eCommerce Value Chain</span>
    </div>
    <div id="header-right">
      <span id="version-pill">v 0.1</span>
    </div>
  </div>

  <!-- Breadcrumb navigation (replaces dropdown filters) -->
  <div id="breadcrumb-bar">
    <div id="house-toggle" class="crumb-toggle" title="Toggle Strategy House">
      <span class="crumb-house">üè†</span>
      <span id="house-toggle-label">Collapse Strategy House</span>
    </div>

    <div class="crumbs" id="crumbs">
      <!-- Filled dynamically -->
      <span class="sep">‚Ä∫</span>
      <span style="font-size:12px; color:#777; font-weight:800;">Select a stream (L0) to begin.</span>
    </div>
  </div>

  <div id="mini-nav" onclick="toggleHouse(true)">
    <div id="mini-nav-text">View: <strong>Strategy House</strong></div>
    <div style="font-size:11px; text-transform:uppercase; letter-spacing:1px;">‚ñº Expand House</div>
  </div>

  <div id="strategy-house-container">
    <div class="house-grid">
      <div id="house-roof" class="house-section">
        <div class="house-title">Manage the Business</div>
        <div class="btn-container" id="cont-manage"></div>
      </div>
      <div id="house-pillar-run" class="house-section">
        <div class="house-title">Run the Business</div>
        <div class="btn-container" id="cont-run"></div>
      </div>
      <div id="house-pillar-transform" class="house-section">
        <div class="house-title">Transform the Business</div>
        <div class="btn-container" id="cont-transform"></div>
      </div>
      <div id="house-foundation" class="house-section">
        <div class="house-title">Foundations & Enablers</div>
        <div class="btn-container" id="cont-foundation"></div>
      </div>
    </div>
  </div>

  <div id="error-msg">Cannot load data.json. Ensure file exists and use a local server.</div>

  <div id="context-bar">
    <div style="display:flex; align-items:center">
      <h2 id="ctx-title">Overview</h2>
      <span id="ctx-desc">Select a Value Stream from the Strategy House to navigate.</span>
    </div>
    <div id="ctx-owner"></div>
  </div>

  <div id="l1-container"></div>

  <div id="workspace">
    <div style="color:#bbb; margin:auto; font-size:18px; text-align:center; padding-top: 60px;">
      <div style="font-size: 50px; color:#e0e0e0; margin-bottom: 20px;">‚ü∞</div>
      Select a Value Stream above to view the process chain.
    </div>
  </div>

  <div id="tooltip"></div>

  <div id="app-footer">DHL Ecommerce Global IT , Head of Data Driven Governce, Serhat Kut,PHD 2026</div>

  <script>
    const houseContainer = document.getElementById('strategy-house-container');
    const miniNav = document.getElementById('mini-nav');
    const miniNavText = document.getElementById('mini-nav-text');
    const l1Container = document.getElementById('l1-container');
    const workspace = document.getElementById('workspace');
    const tooltip = document.getElementById('tooltip');

    // Breadcrumb
    const crumbsEl = document.getElementById('crumbs');
    const houseToggleBtn = document.getElementById('house-toggle');
    const houseToggleLabel = document.getElementById('house-toggle-label');

    let rootData = null;
    let currentL0 = null;
    let currentL1 = null;
    let currentL2 = null;
    let currentL3 = null;

    d3.json("data.json").then(function(data) {
      if(!data || !data.children) return;
      rootData = data;
      renderHouse(data);
      renderCrumbs();
    }).catch(err => {
      document.getElementById('error-msg').style.display = 'block';
      houseContainer.style.display = 'none';
    });

    function parseInfo(str) {
      if(!str) return {id:"", name:""};
      const parts = str.split(":");
      return { id: parts[0].trim(), name: parts.slice(1).join(":").trim() || parts[0].trim() };
    }

    function toggleHouse(show) {
      if(show) {
        houseContainer.classList.remove('collapsed');
        miniNav.style.display = 'none';
        houseToggleLabel.textContent = "Collapse Strategy House";
      } else {
        houseContainer.classList.add('collapsed');
        setTimeout(() => { miniNav.style.display = 'flex'; }, 300);
        houseToggleLabel.textContent = "Expand Strategy House";
      }
    }

    houseToggleBtn.addEventListener('click', () => {
      const isCollapsed = houseContainer.classList.contains('collapsed');
      toggleHouse(isCollapsed); // if collapsed -> show, else collapse
    });

    function renderHouse(data) {
      const containers = {
        'manage': document.getElementById('cont-manage'),
        'run': document.getElementById('cont-run'),
        'transform': document.getElementById('cont-transform'),
        'foundation': document.getElementById('cont-foundation')
      };

      data.children.sort((a,b) => a.name.localeCompare(b.name));
      data.children.forEach(l0 => {
        const cat = (l0.category || "").toLowerCase();
        let target = containers['foundation'];
        if(cat.includes('manage')) target = containers['manage'];
        else if(cat.includes('run')) target = containers['run'];
        else if(cat.includes('change') || cat.includes('transform')) target = containers['transform'];

        const btn = document.createElement('button');
        const info = parseInfo(l0.name);
        btn.className = 'l0-btn';
        btn.innerHTML = `<span class="l0-btn-id">${info.id}</span><span class="l0-btn-name">${info.name}</span>`;
        btn.onclick = () => selectL0(l0, btn);
        target.appendChild(btn);
      });
    }

    function renderCrumbs(){
      crumbsEl.innerHTML = '';

      function addSep(){
        const s = document.createElement('span');
        s.className = 'sep';
        s.textContent = '‚Ä∫';
        crumbsEl.appendChild(s);
      }

      function addCrumb(levelClass, node){
        if(!node) return;
        const inf = parseInfo(node.name);
        const c = document.createElement('span');
        c.className = `crumb ${levelClass}`;
        c.title = inf.name;
        c.innerHTML = `<span class="cid">${inf.id}</span><span class="cname">${inf.name}</span>`;
        crumbsEl.appendChild(c);
      }

      if(!currentL0){
        const hint = document.createElement('span');
        hint.style.cssText = "font-size:12px; color:#777; font-weight:800;";
        hint.textContent = "Select a stream (L0) to begin.";
        crumbsEl.appendChild(hint);
        return;
      }

      addCrumb('l0', currentL0);
      if(currentL1){ addSep(); addCrumb('l1', currentL1); }
      if(currentL2){ addSep(); addCrumb('l2', currentL2); }
      if(currentL3){ addSep(); addCrumb('l3', currentL3); }
    }

    function selectL0(l0Data, btn) {
      currentL0 = l0Data;
      currentL1 = null;
      currentL2 = null;
      currentL3 = null;

      document.querySelectorAll('.l0-btn').forEach(b => b.classList.remove('active'));
      if(btn) btn.classList.add('active');

      const info = parseInfo(l0Data.name);
      document.getElementById('ctx-title').innerText = `${info.name}`;
      document.getElementById('ctx-desc').innerText = l0Data.description || "No description.";
      document.getElementById('ctx-owner').innerText = (l0Data.owner || "Unassigned").toUpperCase();

      miniNavText.innerHTML = `Active Stream: <strong style="color:var(--dhl-yellow)">${info.name}</strong>`;
      toggleHouse(false);

      l1Container.innerHTML = '';
      workspace.innerHTML = '<div style="color:#999; margin:auto; font-size:16px; padding-top:60px;">Select a Process Domain (L1 Chevron) to view details.</div>';

      if(l0Data.children) {
        l0Data.children.forEach((l1, idx) => {
          const div = document.createElement('div');
          div.className = 'l1-chevron';
          if(idx === 0) div.classList.add('first');
          const inf = parseInfo(l1.name);
          div.innerHTML = `<span class="l1-id">${inf.id}</span><span class="l1-name">${inf.name}</span>`;
          div.onclick = () => selectL1(l1, div);
          div.onmousemove = (e) => showTooltip(e, inf.name, l1.description, `Owner: ${l1.owner||"-"}`);
          div.onmouseleave = hideTooltip;
          l1Container.appendChild(div);
        });
      }

      renderCrumbs();
    }

    function selectL1(l1Data, chevron) {
      currentL1 = l1Data;
      currentL2 = null;
      currentL3 = null;

      document.querySelectorAll('.l1-chevron').forEach(c => c.classList.remove('active'));
      chevron.classList.add('active');
      workspace.innerHTML = '';

      if(l1Data.children) {
        l1Data.children.forEach((l2, idx) => {
          const l2Inf = parseInfo(l2.name);
          const card = document.createElement('div');
          card.className = 'l2-chain-item';
          if(idx === 0) card.classList.add('first');

          card.innerHTML = `
            <div class="l2-bar"></div>
            <span class="l2-id">${l2Inf.id}</span>
            <span class="l2-name">${l2Inf.name}</span>
            <div class="l3-list" id="l3-list-${idx}"></div>
          `;

          // Click anywhere in L2 card to set breadcrumb L2 context
          card.addEventListener('click', (ev) => {
            // Avoid stealing clicks from L3 hover interactions - still ok
            currentL2 = l2;
            currentL3 = null;
            renderCrumbs();
          });

          workspace.appendChild(card);

          const list = card.querySelector(`#l3-list-${idx}`);
          if(l2.children && l2.children.length > 0) {
            l2.children.forEach(l3 => {
              const l3Inf = parseInfo(l3.name);
              const item = document.createElement('div');
              item.className = 'l3-item';
              item.innerHTML = `
                <div class="l3-head"><span>${l3Inf.id}</span></div>
                <div class="l3-body">${l3Inf.name}</div>
              `;

              // Clicking L3 sets L2+L3 in breadcrumb
              item.addEventListener('click', (ev) => {
                ev.stopPropagation();
                currentL2 = l2;
                currentL3 = l3;
                renderCrumbs();
              });

              item.onmousemove = (e) => {
                const meta = `<b>Owner:</b> ${l3.owner||l2.owner||"-"}<br><b>Trigger:</b> ${l3.trigger||"-"}<br><b>Outcome:</b> ${l3.outcome||"-"}`;
                showTooltip(e, l3Inf.name, l3.description, meta);
              };
              item.onmouseleave = hideTooltip;

              list.appendChild(item);
            });
          } else {
            list.innerHTML = `<div style="padding:10px; color:#ccc; font-style:italic;">No L3 steps.</div>`;
          }
        });
      }

      renderCrumbs();
    }

    function showTooltip(e, title, desc, meta) {
      tooltip.style.display = 'block';
      tooltip.style.left = (e.clientX + 15) + 'px';
      tooltip.style.top = (e.clientY + 15) + 'px';
      tooltip.innerHTML = `<h4>${title}</h4><p>${desc||""}</p><div class="meta">${meta||""}</div>`;
    }
    function hideTooltip() { tooltip.style.display = 'none'; }
  </script>
</body>
</html>
