<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DHL eCommerce Â· Service Blueprint Journey</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    /* =========================
       DHL BRAND & THEME
       ========================= */
    :root {
      --dhl-red: #D40511;
      --dhl-yellow: #FFCC00;
      --dhl-black: #101828;
      --bg: #F4F5F7;
      --card-bg: #FFFFFF;
      --border: #E5E7EB;
      
      --col-w: 240px; 
      --lane-head-w: 220px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--dhl-black);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* =========================
       HEADER
       ========================= */
    header {
      height: 64px;
      background: var(--dhl-red);
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
    }
    .brand { font-weight: 900; font-size: 20px; display: flex; align-items: center; gap: 12px; }
    .brand span { background: white; color: var(--dhl-red); padding: 2px 8px; border-radius: 4px; }
    
    .controls { display: flex; gap: 12px; }
    .toggle-btn {
      background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
      color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer;
      font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px;
      transition: all 0.2s;
    }
    .toggle-btn:hover { background: rgba(255,255,255,0.3); }
    .toggle-btn.active { background: var(--dhl-yellow); color: var(--dhl-black); border-color: var(--dhl-yellow); }

    /* =========================
       JOURNEY GRID
       ========================= */
    .blueprint-container {
      flex: 1;
      overflow: auto;
      display: grid;
      /* Lane Header + 6 Journey Steps */
      grid-template-columns: var(--lane-head-w) repeat(6, var(--col-w)); 
      position: relative;
    }

    /* --- TOP STAGES (Sticky) --- */
    .corner-plate {
      position: sticky; top: 0; left: 0; z-index: 50;
      background: #fff; border-bottom: 4px solid var(--dhl-red);
      border-right: 1px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 14px; color: var(--dhl-red);
      text-transform: uppercase; letter-spacing: 0.5px;
    }

    .stage-head {
      position: sticky; top: 0; z-index: 40;
      background: #fff; border-bottom: 4px solid var(--dhl-red);
      border-right: 1px solid var(--border);
      padding: 16px;
    }
    .stage-step { font-size: 10px; font-weight: 700; color: #9CA3AF; text-transform: uppercase; margin-bottom: 4px; }
    .stage-name { font-size: 16px; font-weight: 800; color: var(--dhl-black); }
    .stage-icon { font-size: 20px; margin-bottom: 4px; display: block; }

    /* --- SWIMLANES --- */
    .lane-head {
      position: sticky; left: 0; z-index: 30;
      background: #fff; border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 20px; display: flex; flex-direction: column; justify-content: center;
    }
    .lane-title { font-size: 14px; font-weight: 800; margin-bottom: 4px; }
    .lane-desc { font-size: 11px; color: #6B7280; line-height: 1.4; }

    .cell {
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 12px; display: flex; flex-direction: column; gap: 8px;
      transition: background 0.2s;
    }
    .cell:hover { background: #F9FAFB; }

    /* --- VISUAL HIERARCHY --- */
    /* Frontstage (Hero) */
    .frontstage .lane-head { border-left: 5px solid var(--dhl-red); background: #FFF; }
    .frontstage .cell { background: #FFF; min-height: 160px; }
    .frontstage .lane-title { color: var(--dhl-red); font-size: 16px; }

    /* Backstage (Foundation) */
    .backstage { display: contents; } /* Allows children to sit in grid */
    .backstage.hidden .lane-head, .backstage.hidden .cell { display: none; }
    
    .backstage .lane-head { border-left: 5px solid #9CA3AF; background: #F3F4F6; }
    .backstage .cell { background: #F3F4F6; min-height: 120px; }
    .backstage .lane-title { color: #4B5563; }
    
    /* The Stack Container */
    .stack-group {
      display: flex; flex-direction: column; gap: 6px;
    }
    .stack-label {
      font-size: 10px; font-weight: 700; color: #6B7280; text-transform: uppercase;
      margin-top: 4px; margin-bottom: 2px;
    }

    /* --- CARDS --- */
    .card {
      background: white;
      border: 1px solid #E5E7EB;
      border-left: 4px solid #ccc;
      border-radius: 8px;
      padding: 10px 12px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .card:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); border-color: var(--dhl-red); }

    .card-id { font-size: 9px; font-weight: 700; color: #9CA3AF; margin-bottom: 4px; }
    .card-name { font-size: 12px; font-weight: 700; line-height: 1.3; color: #111827; }

    /* Card Colors */
    .l0-L2C { border-left-color: var(--dhl-yellow); }
    .l0-O2D { border-left-color: var(--dhl-red); }
    .l0-P2R { border-left-color: #F97316; }
    .l0-D2O, .l0-S2E { border-left-color: #4B5563; } /* Grey for Strategy */
    .l0-ITF, .l0-DA { border-left-color: #8B5CF6; }   /* Purple for Tech */
    
    /* --- POPUP --- */
    .modal-overlay {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.4); backdrop-filter: blur(2px);
      z-index: 200; display: none; align-items: center; justify-content: center;
    }
    .modal {
      background: white; width: 440px; border-radius: 12px; overflow: hidden;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2); animation: pop 0.2s ease-out;
    }
    @keyframes pop { from{transform:scale(0.95);opacity:0} to{transform:scale(1);opacity:1} }
    
    .modal-head { background: var(--dhl-red); padding: 20px; color: white; }
    .modal-body { padding: 24px; }

  </style>
</head>
<body>

<header>
  <div class="brand"><span>DHL</span> Customer Journey</div>
  <div class="controls">
    <button class="toggle-btn active" id="btnFound" onclick="toggleFoundation()">
      Foundation Layer: <span id="foundState">ON</span>
    </button>
  </div>
</header>

<div class="blueprint-container" id="grid">
  </div>

<div class="modal-overlay" id="modal" onclick="closeModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-head">
      <div style="font-size:11px; opacity:0.8; font-weight:700" id="m_id">ID</div>
      <div style="font-size:18px; font-weight:800; margin-top:4px" id="m_name">Title</div>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:16px">
        <div style="font-size:10px; font-weight:700; color:#888; text-transform:uppercase">Owner</div>
        <div style="font-size:14px" id="m_owner">-</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="font-size:10px; font-weight:700; color:#888; text-transform:uppercase">Description</div>
        <div style="font-size:14px; line-height:1.5" id="m_desc">-</div>
      </div>
      <div style="background:#F9FAFB; padding:12px; border-radius:8px; border:1px solid #E5E7EB">
        <div style="font-size:10px; font-weight:700; color:#888; text-transform:uppercase">Outcome</div>
        <div style="font-size:13px; font-weight:700; color:var(--dhl-red)" id="m_out">-</div>
      </div>
    </div>
  </div>
</div>

<script>
  // 1. CONFIGURATION: Journey Steps (The "Picture")
  const STAGES = [
    { id: "S1", name: "Discover", icon: "ðŸ”", desc: "Strategy & Plan" },
    { id: "S2", name: "Join",     icon: "ðŸ“", desc: "Contract & Onboard" },
    { id: "S3", name: "Ship",     icon: "ðŸ“¦", desc: "Booking & Induction" },
    { id: "S4", name: "Track",    icon: "ðŸŒ", desc: "Network & Transit" },
    { id: "S5", name: "Receive",  icon: "ðŸ¡", desc: "Last Mile & POD" },
    { id: "S6", name: "Support",  icon: "ðŸ’¬", desc: "Claims & Loyalty" }
  ];

  // 2. CONFIGURATION: Swimlanes
  const LANES = [
    // FRONTSTAGE (Hero)
    { id: "L2C", name: "Commercial", desc: "Sales, Pricing, & Care", type: "front" },
    { id: "O2D", name: "Operations", desc: "Physical Logistics", type: "front" },
    // BACKSTAGE (Enablers Stacked)
    { id: "FOUNDATION", name: "Strategic Foundation", desc: "Strategy, Design, IT, GRC", type: "back" }
  ];

  let ALL_L1 = [];

  // 3. MAPPING LOGIC
  function getStage(p) {
    const id = p.id;
    const n = (p.name||"").toLowerCase();

    // D2O/Strategy -> Discover (S1)
    if(id.startsWith("D2O") || id.startsWith("S2E") || id.startsWith("I2P")) return "S1";
    
    // Commercial (L2C)
    if(id.startsWith("L2C")) {
      if(id.includes("01") || id.includes("02")) return "S1"; // Discover
      if(id.includes("03") || id.includes("04")) return "S2"; // Join
      if(id.includes("05")) return "S3"; // Ship
      if(id.includes("Billing") || id.includes("06")) return "S6"; // Support
      return "S1";
    }

    // Operations (O2D)
    if(id.startsWith("O2D")) {
      if(id.includes("01")) return "S3"; // Ship (Data Entry)
      if(id.includes("02") || id.includes("03")) return "S3"; // Processing
      if(id.includes("10") || id.includes("11")) return "S5"; // Receive
      if(id.includes("04") || id.includes("07")) return "S4"; // Track/Transit
      return "S4";
    }

    // P2R (Issues)
    if(id.startsWith("P2R")) {
      if(n.includes("claim") || n.includes("comp")) return "S6";
      return "S4"; // In-transit issue
    }

    // Enablers
    if(id.startsWith("ITF") || id.startsWith("DA")) {
        if(n.includes("driver")) return "S5"; // Driver App
        if(n.includes("sort")) return "S3"; // Sort logic
        return "S2"; // General Platform
    }
    
    if(id.startsWith("GRC") || id.startsWith("R2R")) return "S6"; // Audit/Finance

    return "S1";
  }

  // 4. RENDERING
  const grid = document.getElementById('grid');

  async function load(){
    try {
      const res = await fetch('data.json');
      const root = await res.json();
      extractL1(root);
      render();
    } catch(e) { console.error(e); }
  }

  // Get only L1 (e.g. L2C_01)
  function extractL1(node){
    if(node.id && node.id.split('_').length === 2) ALL_L1.push(node);
    if(node.children) node.children.forEach(extractL1);
  }

  function render(){
    grid.innerHTML = "";

    // A. Corner
    const corner = document.createElement("div");
    corner.className = "corner-plate";
    corner.textContent = "PROCESS AREA";
    grid.appendChild(corner);

    // B. Headers
    STAGES.forEach(s => {
      const h = document.createElement("div");
      h.className = "stage-head";
      h.innerHTML = `<div class="stage-step">Step ${s.id.replace('S','')}</div>
                     <span class="stage-icon">${s.icon}</span>
                     <div class="stage-name">${s.name}</div>`;
      grid.appendChild(h);
    });

    // C. Swimlanes
    LANES.forEach(lane => {
      // Wrapper for Backstage toggling
      const rowGroup = document.createElement("div");
      rowGroup.className = lane.type === 'front' ? 'frontstage' : 'backstage';
      rowGroup.id = `row-${lane.id}`;
      
      // Label
      const label = document.createElement("div");
      label.className = "lane-head";
      label.innerHTML = `<div class="lane-title">${lane.name}</div>
                         <div class="lane-desc">${lane.desc}</div>`;
      rowGroup.appendChild(label);
      grid.appendChild(label); // Append label directly to grid, but keep class ref

      // Cells
      STAGES.forEach(st => {
        const cell = document.createElement("div");
        cell.className = "cell";

        // Filter processes for this Cell
        let hits = [];
        if(lane.id === "FOUNDATION") {
          // Catch-all for Strategy, GRC, IT, D2O
          hits = ALL_L1.filter(p => {
             const pre = p.id.split('_')[0];
             return ["S2E","D2O","GRC","ITF","DA","I2P","R2R","S2P","H2R"].includes(pre) && getStage(p) === st.id;
          });
        } else {
          // Specific Frontstage lanes
          hits = ALL_L1.filter(p => {
            const pre = p.id.split('_')[0];
            // Map L2C -> Commercial, O2D -> Ops.  P2R -> Ops? No, let's put P2R in Ops for simplicity or create P2R lane.
            // For this design, let's put P2R in Operations for "Issue Mgmt".
            if(lane.id === "O2D" && (pre === "O2D" || pre === "P2R")) return getStage(p) === st.id;
            if(lane.id === "L2C" && pre === "L2C") return getStage(p) === st.id;
            return false;
          });
        }

        // Render Stacked
        if(hits.length > 0){
          hits.sort((a,b)=>a.id.localeCompare(b.id));
          hits.forEach(p => {
            const c = document.createElement("div");
            c.className = `card l0-${p.id.split('_')[0]}`;
            c.innerHTML = `<div class="card-id">${p.id}</div>
                           <div class="card-name">${p.name.split(':').pop()}</div>`;
            c.onclick = ()=>showModal(p);
            cell.appendChild(c);
          });
        }
        
        rowGroup.appendChild(cell);
        grid.appendChild(cell);
      });

      // We don't append rowGroup to grid because Grid Layout needs direct children.
      // We use the class on the children to manage visibility.
      // Add class to the specific DOM elements we just added.
      const children = Array.from(grid.children).slice(-7); // Last 7 (Label + 6 Cells)
      children.forEach(el => el.classList.add(lane.type === 'front' ? 'frontstage' : 'backstage'));
    });
  }

  // 5. TOGGLE LOGIC
  function toggleFoundation(){
    const els = document.querySelectorAll('.backstage');
    const btn = document.getElementById('btnFound');
    const state = document.getElementById('foundState');
    
    els.forEach(el => el.classList.toggle('hidden'));
    
    if(btn.classList.contains('active')){
      btn.classList.remove('active');
      state.textContent = "OFF";
    } else {
      btn.classList.add('active');
      state.textContent = "ON";
    }
  }

  function showModal(p){
    document.getElementById('m_id').textContent = p.id;
    document.getElementById('m_name').textContent = p.name.split(':').pop();
    document.getElementById('m_owner').textContent = p.owner || "Unassigned";
    document.getElementById('m_desc').textContent = p.description;
    document.getElementById('m_out').textContent = p.outcome || "End";
    document.getElementById('modal').style.display = "flex";
  }

  function closeModal(){
    document.getElementById('modal').style.display = "none";
  }

  load();
</script>
</body>
</html>
