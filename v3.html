<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DHL Value Chain - Compact View</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f4f4f4; display: flex; flex-direction: column; height: 100vh; }
        
        /* --- ERROR NOTIFICATION --- */
        #error-msg {
            display: none;
            background: #ffe6e6; border-bottom: 2px solid red; color: #cc0000;
            padding: 20px; text-align: center; font-weight: bold;
        }

        /* --- TOP NAV (L0 FILTERS) --- */
        #l0-bar {
            background-color: #333;
            padding: 8px 15px;
            white-space: nowrap;
            overflow-x: auto;
            display: flex;
            gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
            height: 40px;
            align-items: center;
        }
        .l0-btn {
            background: #555;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.2s;
        }
        .l0-btn:hover { background: #777; }
        .l0-btn.active { background: #d40511; color: white; }

        /* --- CHEVRON AREA (L1) --- */
        #chevron-container {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #ddd;
            flex-shrink: 0;
            display: flex;
            flex-wrap: wrap; /* Enables multi-row */
            gap: 5px; /* Vertical gap between rows */
            align-content: flex-start;
            min-height: 80px;
        }

        /* COMPACT CHEVRON DESIGN */
        .chevron {
            position: relative;
            background: #e0e0e0;
            height: 45px;          
            width: 155px;          
            margin-right: 5px;     
            margin-bottom: 8px;    
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-left: 25px;    
            padding-right: 10px;
            cursor: pointer;
            transition: all 0.1s;
            color: #333;
            font-size: 11px;       
            line-height: 1.1;
            user-select: none;
            
            clip-path: polygon(
                0% 0%, 
                calc(100% - 15px) 0%, 
                100% 50%, 
                calc(100% - 15px) 100%, 
                0% 100%, 
                15px 50%
            );
        }

        .chevron.first-in-row {
            clip-path: polygon(
                0% 0%, 
                calc(100% - 15px) 0%, 
                100% 50%, 
                calc(100% - 15px) 100%, 
                0% 100%
            );
            padding-left: 10px;
        }

        .chevron strong { display: block; color: #d40511; margin-bottom: 2px; }
        .chevron:hover { background: #d0d0d0; transform: translateY(-1px); }
        .chevron.active { background: #ffcc00; color: black; }

        /* --- DETAILS AREA (L2 & L3) --- */
        #details-panel {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f9f9f9;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 15px;
        }
        
        /* L2 Group Card */
        .l2-card {
            background: white;
            border-top: 3px solid #d40511;
            width: 300px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .l2-title { font-size: 13px; font-weight: bold; color: #333; margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        .l3-item { 
            font-size: 12px; color: #555; margin-bottom: 4px; padding: 3px 5px;
            cursor: help; /* Shows question mark cursor */
            border-radius: 3px;
        }
        .l3-item:hover { background-color: #fffae6; color: #000; }

        /* --- FLOATING HOVER WINDOW (TOOLTIP) --- */
        #tooltip {
            position: fixed;
            display: none;
            background: #333;
            color: #fff;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 12px;
            max-width: 250px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            pointer-events: none;
            line-height: 1.4;
        }
        #tooltip strong { color: #ffcc00; display: block; margin-bottom: 4px; }
        #tooltip .meta { color: #bbb; margin-top: 6px; font-size: 11px; border-top: 1px solid #555; padding-top: 4px; }

    </style>
</head>
<body>

<div id="error-msg">
    Error: Cannot load "data.json".<br>
    If you are opening this file directly from your computer, this is expected (CORS security).<br>
    Please upload this to GitHub or run a local server.
</div>

<div id="tooltip"></div>

<div id="l0-bar"></div>

<div id="chevron-container"></div>

<div id="details-panel">
    <div style="color:#999; margin:auto;">Loading data...</div>
</div>

<script>
    const l0Bar = document.getElementById('l0-bar');
    const chevronContainer = document.getElementById('chevron-container');
    const detailsPanel = document.getElementById('details-panel');
    const tooltip = document.getElementById('tooltip');
    const errorMsg = document.getElementById('error-msg');

    // ===============================================
    // LOAD DATA EXTERNALLY
    // ===============================================
    d3.json("data.json").then(function(data) {
        
        // Hide loading
        detailsPanel.innerHTML = '<div style="color:#999; margin:auto;">Select a value stream to begin.</div>';
        
        // Init
        renderL0(data);

    }).catch(function(error) {
        console.error(error);
        errorMsg.style.display = 'block';
        detailsPanel.innerHTML = '';
    });

    // --- TOOLTIP LOGIC ---
    function showTooltip(e, title, content, meta) {
        tooltip.style.display = 'block';
        tooltip.style.left = (e.clientX + 15) + 'px';
        tooltip.style.top = (e.clientY + 15) + 'px';
        
        let html = `<strong>${title}</strong>${content}`;
        if(meta) html += `<div class='meta'>${meta}</div>`;
        tooltip.innerHTML = html;
    }
    
    function hideTooltip() {
        tooltip.style.display = 'none';
    }

    // 1. Render Top Filter Bar (L0)
    function renderL0(data) {
        if (!data || !data.children) return;
        
        data.children.sort((a,b) => a.name.localeCompare(b.name));

        data.children.forEach((l0, index) => {
            const btn = document.createElement('button');
            const shortName = l0.name.split(":")[0].trim();
            
            btn.className = 'l0-btn';
            btn.textContent = shortName;
            btn.onclick = () => selectL0(l0, btn);
            
            // Auto-select first
            if (index === 0) selectL0(l0, btn);
            
            l0Bar.appendChild(btn);
        });
    }

    // 2. Render Chevrons (L1)
    function selectL0(l0Data, btnElement) {
        document.querySelectorAll('.l0-btn').forEach(b => b.classList.remove('active'));
        if(btnElement) btnElement.classList.add('active');

        chevronContainer.innerHTML = '';
        detailsPanel.innerHTML = '<div style="color:#999; width:100%; text-align:center; padding-top:20px;">Select a process step above to view details.</div>';

        if (l0Data.children) {
            l0Data.children.forEach((l1, index) => {
                const div = document.createElement('div');
                div.className = 'chevron';
                if(index === 0) div.classList.add('first-in-row'); 

                const parts = l1.name.split(":");
                const id = parts[0];
                const text = parts[1] ? parts[1].trim() : "";
                const displayText = text.length > 35 ? text.substring(0,32) + "..." : text;

                div.innerHTML = `<strong>${id}</strong><span>${displayText}</span>`;
                
                div.onclick = () => selectL1(l1, div);

                // HOVER: Show L1 Details
                div.onmousemove = (e) => showTooltip(e, l1.name, l1.description || "No description", `Owner: ${l1.owner || "N/A"}`);
                div.onmouseleave = hideTooltip;
                
                chevronContainer.appendChild(div);
            });
        }
    }

    // 3. Render Details (L2 Cards with L3 Lists)
    function selectL1(l1Data, chevronElement) {
        document.querySelectorAll('.chevron').forEach(c => c.classList.remove('active'));
        chevronElement.classList.add('active');
        detailsPanel.innerHTML = '';

        if (l1Data.children) {
            l1Data.children.forEach(l2 => {
                const card = document.createElement('div');
                card.className = 'l2-card';
                
                const title = document.createElement('div');
                title.className = 'l2-title';
                title.innerText = l2.name.split(":")[1] ? l2.name.split(":")[1].trim() : l2.name;
                card.appendChild(title);

                if (l2.children) {
                    l2.children.forEach(l3 => {
                        const item = document.createElement('div');
                        item.className = 'l3-item';
                        item.innerText = l3.name.split(":")[1] ? l3.name.split(":")[1].trim() : l3.name;
                        
                        // HOVER: Show L3 Specifics (Trigger, Outcome, Owner)
                        item.onmousemove = (e) => {
                            const metaInfo = `
                                Owner: ${l3.owner || l2.owner || "N/A"}<br>
                                Trigger: ${l3.trigger || "-"}<br>
                                Outcome: ${l3.outcome || "-"}
                            `;
                            showTooltip(e, l3.name, l3.description || "No description", metaInfo);
                        };
                        item.onmouseleave = hideTooltip;

                        card.appendChild(item);
                    });
                }
                detailsPanel.appendChild(card);
            });
        } else {
            detailsPanel.innerHTML = '<div style="padding:20px; color:#999">No details defined for this process.</div>';
        }
    }

</script>
</body>
</html>
