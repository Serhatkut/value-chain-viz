<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DHL eCommerce ¬∑ Digital Customer Journey</title>

  <style>
    /* =========================
       DHL DIGITAL BRAND TOKENS
       ========================= */
    :root {
      --dhl-red: #D40511;
      --dhl-yellow: #FFCC00;
      --dhl-light-gray: #f2f4f8;
      --dhl-dark: #101828;
      
      --bg: #ffffff;
      --line: #e6e8ee;
      --radius: 12px;
      --shadow: 0 12px 30px rgba(0,0,0,0.12);
      
      --lane-w: 240px;
      --step-w: 380px;
      --header-h: 70px;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Delivery", "Helvetica Neue", Helvetica, Arial, sans-serif;
      color: var(--dhl-dark);
      background: var(--bg);
      overflow-x: hidden;
    }

    /* =========================
       HEADER & NAVIGATION
       ========================= */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--dhl-red);
      color: white;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .brand { display: flex; align-items: center; gap: 15px; }
    .logo-box { 
      width: 40px; height: 40px; background: white; 
      border-radius: 6px; display: flex; align-items: center; justify-content: center;
    }
    .logo-box::after { content: "DHL"; color: var(--dhl-red); font-weight: 900; font-size: 14px; }

    .search-container { flex: 1; max-width: 500px; margin: 0 40px; position: relative; }
    .search-container input {
      width: 100%; padding: 10px 18px; border-radius: 20px; border: none; outline: none;
      font-size: 14px; background: rgba(255,255,255,0.15); color: white;
    }
    .search-container input::placeholder { color: rgba(255,255,255,0.7); }
    .search-container input:focus { background: white; color: var(--dhl-dark); }

    /* =========================
       MAIN JOURNEY GRID
       ========================= */
    .viewport {
      width: 100vw; height: calc(100vh - 64px);
      overflow: auto; position: relative;
    }

    .journey-grid {
      display: grid;
      grid-template-columns: var(--lane-w) repeat(var(--cols), var(--step-w));
      width: max-content;
    }

    /* Sticky Lane Labels */
    .lane-label {
      position: sticky; left: 0; z-index: 50;
      background: white; border-right: 3px solid var(--dhl-yellow);
      border-bottom: 1px solid var(--line);
      padding: 20px; display: flex; flex-direction: column; justify-content: center;
    }
    .lane-label b { font-size: 15px; color: var(--dhl-red); text-transform: uppercase; letter-spacing: 0.5px; }
    .lane-label span { font-size: 11px; color: #666; margin-top: 4px; }

    /* Phase Headers (L0 Connection) */
    .phase-header {
      background: var(--dhl-light-gray);
      padding: 15px 25px; border-bottom: 1px solid var(--line);
      display: flex; flex-direction: column; gap: 5px;
      border-right: 1px solid var(--line);
    }
    .l0-tag { font-size: 10px; font-weight: 800; color: var(--dhl-red); background: white; padding: 2px 8px; border-radius: 4px; width: fit-content; }
    .phase-title { font-weight: 800; font-size: 16px; }

    /* Cells & Cards */
    .cell {
      padding: 20px; border-right: 1px solid var(--line); border-bottom: 1px solid var(--line);
      display: flex; flex-direction: column; gap: 12px; min-height: 180px;
    }

    .step-card {
      background: white; border: 1px solid var(--line); border-radius: var(--radius);
      padding: 16px; cursor: pointer; transition: 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
      position: relative; box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }
    .step-card:hover { 
      transform: scale(1.02); border-color: var(--dhl-red); 
      box-shadow: 0 8px 20px rgba(0,0,0,0.08); 
    }
    .step-card.active { border: 2px solid var(--dhl-red); background: #fffdf0; }

    .step-id { font-size: 10px; font-weight: 700; color: #999; margin-bottom: 6px; }
    .step-name { font-weight: 700; font-size: 14px; line-height: 1.3; }
    
    .touchpoints { display: flex; gap: 8px; margin-top: 12px; }
    .tp-icon { width: 22px; height: 22px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 10px; }

    /* Sentiment Row (Emoji Tracking) */
    .sentiment-row { background: #fafafa; border-bottom: 2px solid var(--line); }
    .emoji-track { font-size: 20px; display: flex; align-items: center; gap: 10px; }

    /* =========================
       FLOATING POPUP (DETAIL)
       ========================= */
    #detailPopup {
      position: fixed; display: none; z-index: 200;
      width: 320px; background: white; border-radius: var(--radius);
      box-shadow: var(--shadow); border: 1px solid var(--dhl-red);
      padding: 20px; pointer-events: auto;
    }
    .popup-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
    .close-btn { cursor: pointer; font-size: 20px; color: #ccc; }
    .popup-label { font-size: 11px; font-weight: 700; color: var(--dhl-red); text-transform: uppercase; margin-bottom: 5px; }
    .popup-val { font-size: 13px; line-height: 1.4; margin-bottom: 12px; }

  </style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo-box"></div>
    <div>
      <div style="font-weight: 900; letter-spacing: 1px; font-size: 18px;">CUSTOMER JOURNEY</div>
      <div style="font-size: 11px; font-weight: 500; opacity: 0.9;">Process Value Chain Integration (L0-L4)</div>
    </div>
  </div>
  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Search by L4 ID, Owner, or Activity name...">
  </div>
  <div id="status">Syncing Data...</div>
</header>

<div class="viewport">
  <div class="journey-grid" id="journeyGrid">
    </div>
</div>

<div id="detailPopup">
  <div class="popup-header">
    <div id="popId" class="l0-tag" style="background: #f0f0f0;">ID</div>
    <div class="close-btn" onclick="closePopup()">&times;</div>
  </div>
  <h3 id="popName" style="margin: 0 0 15px 0; font-size: 16px;">Process Name</h3>
  
  <div class="popup-label">Owner</div>
  <div id="popOwner" class="popup-val">‚Äî</div>
  
  <div class="popup-label">Description</div>
  <div id="popDesc" class="popup-val">‚Äî</div>
  
  <div class="popup-label">Trigger ‚Üí Outcome</div>
  <div class="popup-val" style="background: var(--dhl-light-gray); padding: 8px; border-radius: 6px;">
    <span id="popTrigger" style="font-style: italic;">‚Äî</span><br>
    <b style="color: var(--dhl-red)">‚ûî</b> <span id="popOutcome">‚Äî</span>
  </div>
</div>

<script>
  let dataIndex = new Map();

  // Define the phases and map them to L0 concepts
  const PHASES = [
    { id: "PH_1", l0: "S2E", title: "Strategy & Market Setup", ids: ["S2E_01_01_01", "S2E_01_02_01"], sentiment: "ü§î" },
    { id: "PH_2", l0: "L2C", title: "Contract & Onboarding", ids: ["L2C_01", "L2C_02"], sentiment: "üìã" },
    { id: "PH_3", l0: "L2C", title: "Order Entry", ids: ["L2C_05"], sentiment: "üñ±Ô∏è" },
    { id: "PH_4", l0: "O2D", title: "Physical Fulfillment", ids: ["O2D_01", "O2D_02"], sentiment: "üöö" },
    { id: "PH_5", l0: "O2D", title: "Network Transit", ids: ["O2D_04", "O2D_07"], sentiment: "üåê" },
    { id: "PH_6", l0: "L2C", title: "Billing & Revenue", ids: ["L2C_06", "R2R_01"], sentiment: "üí≥" },
    { id: "PH_7", l0: "P2R", title: "Care & Resolution", ids: ["P2R_01", "P2R_03"], sentiment: "üìû" }
  ];

  const LANES = [
    { key: "commercial", label: "Commercial (L2C)", color: "var(--dhl-yellow)" },
    { key: "ops", label: "Operations (O2D)", color: "var(--dhl-red)" },
    { key: "enablers", label: "Enablers (IT/DA)", color: "#eee" }
  ];

  async function loadData() {
    try {
      const res = await fetch('data.json');
      const json = await res.json();
      buildIndex(json);
      document.getElementById('status').textContent = "Connected";
      renderJourney();
    } catch (e) {
      document.getElementById('status').textContent = "Offline Mode";
      console.error(e);
    }
  }

  function buildIndex(node) {
    if (node.id) dataIndex.set(node.id, node);
    if (node.children) node.children.forEach(buildIndex);
  }

  function renderJourney() {
    const grid = document.getElementById('journeyGrid');
    grid.style.setProperty('--cols', PHASES.length);
    grid.innerHTML = '';

    // Row 1: L0 Connection Headers
    grid.appendChild(createEmptyCorner());
    PHASES.forEach(ph => {
      const h = document.createElement('div');
      h.className = 'phase-header';
      h.innerHTML = `
        <div class="l0-tag">${ph.l0} Area</div>
        <div class="phase-title">${ph.title}</div>
      `;
      grid.appendChild(h);
    });

    // Row 2: Customer Sentiment Row
    grid.appendChild(createLaneLabel("Customer Experience", "Sentiment & Touchpoints"));
    PHASES.forEach(ph => {
      const cell = document.createElement('div');
      cell.className = 'cell sentiment-row';
      cell.innerHTML = `
        <div class="emoji-track">${ph.sentiment} <span style="font-size:12px; color:#666">Customer Step</span></div>
        <div class="touchpoints">
          <div class="tp-icon" title="Mobile App">üì±</div>
          <div class="tp-icon" title="Web Portal">üíª</div>
          <div class="tp-icon" title="Email">‚úâÔ∏è</div>
        </div>
      `;
      grid.appendChild(cell);
    });

    // Sub-Rows: Process Lanes
    LANES.forEach(lane => {
      grid.appendChild(createLaneLabel(lane.label, "Ownership & Activities"));
      PHASES.forEach(ph => {
        const cell = document.createElement('div');
        cell.className = 'cell';
        
        // Filter L4s based on lane prefix (L2C/O2D/P2R etc)
        const matchedIds = ph.ids.filter(id => {
          if (lane.key === 'commercial') return id.startsWith('L2C') || id.startsWith('S2E');
          if (lane.key === 'ops') return id.startsWith('O2D');
          return id.startsWith('ITF') || id.startsWith('DA') || id.startsWith('R2R');
        });

        matchedIds.forEach(id => {
          const proc = dataIndex.get(id);
          if (proc) cell.appendChild(createStepCard(proc));
        });
        
        grid.appendChild(cell);
      });
    });
  }

  function createStepCard(proc) {
    const card = document.createElement('div');
    card.className = 'step-card';
    card.innerHTML = `
      <div class="step-id">${proc.id}</div>
      <div class="step-name">${proc.name.split(':').pop().trim()}</div>
      <div class="touchpoints">
         <span class="l0-tag" style="background:var(--dhl-light-gray)">${proc.owner || 'TBD'}</span>
      </div>
    `;
    card.onclick = (e) => showPopup(e, proc);
    return card;
  }

  function showPopup(e, proc) {
    const popup = document.getElementById('detailPopup');
    
    // Fill data
    document.getElementById('popId').textContent = proc.id;
    document.getElementById('popName').textContent = proc.name.split(':').pop();
    document.getElementById('popOwner').textContent = proc.owner || 'N/A';
    document.getElementById('popDesc').textContent = proc.description || 'No description found in data.json';
    document.getElementById('popTrigger').textContent = proc.trigger || 'Continuous';
    document.getElementById('popOutcome').textContent = proc.outcome || 'End of process';

    // Position near click
    popup.style.display = 'block';
    const x = Math.min(e.clientX + 20, window.innerWidth - 350);
    const y = Math.min(e.clientY + 20, window.innerHeight - 400);
    popup.style.left = `${x}px`;
    popup.style.top = `${y}px`;

    // Highlight card
    document.querySelectorAll('.step-card').forEach(c => c.classList.remove('active'));
    e.currentTarget.classList.add('active');
    
    e.stopPropagation();
  }

  function closePopup() {
    document.getElementById('detailPopup').style.display = 'none';
  }

  function createLaneLabel(label, sub) {
    const div = document.createElement('div');
    div.className = 'lane-label';
    div.innerHTML = `<b>${label}</b><span>${sub}</span>`;
    return div;
  }

  function createEmptyCorner() {
    const div = document.createElement('div');
    div.className = 'lane-label';
    div.style.background = 'var(--dhl-red)';
    div.style.border = 'none';
    return div;
  }

  window.onclick = closePopup;
  loadData();
</script>

</body>
</html>
