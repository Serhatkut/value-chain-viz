<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DHL eCommerce · Service Blueprint</title>
  <link href="https://fonts.googleapis.com/css2?family=Delivery:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================
       DHL THEME
       ========================= */
    :root {
      --dhl-red: #D40511;
      --dhl-yellow: #FFCC00;
      --dhl-black: #101828;
      
      --bg: #F2F4F7;
      --surface: #FFFFFF;
      --border: #E4E7EC;
      
      --head-h: 60px;
      --lane-w: 240px;
      --col-min: 190px;
      
      /* Deck Height */
      --deck-h: 320px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--dhl-black);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* =========================
       HEADER
       ========================= */
    header {
      height: var(--head-h);
      background: var(--dhl-red);
      color: white;
      display: flex;
      align-items: center;
      padding: 0 24px;
      justify-content: space-between;
      flex-shrink: 0;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .brand { font-family: 'Delivery', sans-serif; font-weight: 900; font-size: 20px; display: flex; align-items: center; gap: 12px; }
    .brand span { background: var(--dhl-yellow); color: var(--dhl-red); padding: 2px 8px; border-radius: 4px; font-size: 14px; }
    
    .legend { display: flex; gap: 20px; font-size: 11px; font-weight: 600; }
    .legend-item { display: flex; align-items: center; gap: 6px; color: white; }
    .dot { width: 10px; height: 10px; border-radius: 2px; background: white; }

    /* =========================
       MAIN GRID (TOP HALF)
       ========================= */
    .grid-wrapper {
      flex: 1;
      overflow: auto;
      display: grid;
      /* Lane Header + 7 Stages */
      grid-template-columns: var(--lane-w) repeat(7, minmax(var(--col-min), 1fr)); 
      /* Explicit Rows for Stability */
      grid-template-rows: auto auto auto auto auto auto;
      background: var(--bg);
      padding-bottom: var(--deck-h); /* Space for fixed deck */
    }

    /* Sticky Headers */
    .corner-plate {
      position: sticky; top: 0; left: 0; z-index: 60;
      background: var(--surface); 
      border-right: 1px solid var(--border);
      border-bottom: 4px solid var(--dhl-red);
      display: flex; align-items: center; justify-content: center;
      padding: 10px; grid-row: 1; grid-column: 1;
    }
    .cp-title { font-weight: 900; font-size: 13px; color: var(--dhl-red); text-transform: uppercase; text-align: center; }

    .stage-head {
      position: sticky; top: 0; z-index: 50;
      background: var(--surface); 
      border-right: 1px solid var(--border);
      border-bottom: 4px solid var(--dhl-red);
      padding: 12px 16px; display: flex; flex-direction: column; gap: 4px;
      grid-row: 1;
    }
    .stage-voice { font-family: 'Delivery', sans-serif; font-size: 13px; font-weight: 900; color: var(--dhl-black); font-style: italic; }
    .stage-meta { font-size: 10px; font-weight: 700; color: #94A3B8; text-transform: uppercase; }

    /* Lane Labels */
    .lane-label {
      position: sticky; left: 0; z-index: 40;
      background: var(--surface);
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 20px; display: flex; flex-direction: column; justify-content: center;
    }
    .lane-title { font-size: 14px; font-weight: 800; color: var(--dhl-black); margin-bottom: 4px; }
    .lane-desc { font-size: 10px; color: #64748B; line-height: 1.3; }
    
    /* Lane Styling */
    .lane-comm { border-left: 6px solid var(--dhl-yellow); background:#FFFBEB; }
    .lane-ops { border-left: 6px solid var(--dhl-red); background:#FEF2F2; }
    .lane-cont { border-left: 6px solid #2563EB; background:#EFF6FF; }
    .lane-found { border-left: 6px solid #475569; background:#F8FAFC; }

    /* Cells */
    .cell {
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 10px; display: flex; flex-direction: column; gap: 8px;
      min-height: 160px; background: white;
    }
    .cell-cont { background: #EFF6FF; min-height: 90px; justify-content: center; }
    .cell-found { background: #F8FAFC; }

    /* =========================
       PROCESS TILES (L1)
       ========================= */
    .tile {
      background: white;
      border: 1px solid #CBD5E1;
      border-left: 4px solid #ccc;
      border-radius: 6px;
      padding: 8px 10px;
      cursor: pointer;
      position: relative;
      transition: all 0.15s ease;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .tile:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px -4px rgba(0,0,0,0.1);
      border-color: var(--dhl-red);
      z-index: 10;
    }
    .tile.active { border-color: var(--dhl-red); background: #FFF7ED; box-shadow: 0 0 0 2px var(--dhl-red); }

    /* Spanning Tiles (For Continuous Lanes) */
    .tile-span {
      height: 40px; display: flex; align-items: center; justify-content: center; gap: 10px;
      background: white; border: 1px solid #93C5FD; border-left: 5px solid #2563EB;
      box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1);
      width: 98%; margin: 0 auto;
    }
    .tile-span:hover { background: #EFF6FF; transform: scale(1.01); }
    .tile-span .t-name { font-size: 12px; font-weight: 800; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Tile Content */
    .t-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .t-id { font-size: 10px; font-weight: 800; color: #64748B; }
    .t-name { font-size: 11px; font-weight: 700; color: #0F172A; line-height: 1.3; }

    /* Color Coding */
    .c-L2C { border-left-color: var(--dhl-yellow); }
    .c-O2D { border-left-color: var(--dhl-red); }
    .c-P2R { border-left-color: #F97316; }
    .c-ITF { border-left-color: #7C3AED; }
    .c-D2O { border-left-color: #475569; }

    /* =========================
       BOTTOM DECK (DETAIL VIEW)
       ========================= */
    #deck {
      position: fixed; bottom: 0; left: 0; width: 100%; height: var(--deck-h);
      background: white; border-top: 4px solid var(--dhl-red);
      z-index: 200; box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
      display: flex; flex-direction: column;
      transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    #deck.open { transform: translateY(0); }

    .deck-header {
      padding: 12px 24px; background: #F8FAFC; border-bottom: 1px solid #E2E8F0;
      display: flex; justify-content: space-between; align-items: center;
    }
    .deck-title { font-size: 16px; font-weight: 800; color: var(--dhl-black); text-transform: uppercase; }
    .deck-meta { font-size: 11px; color: #64748B; display: flex; gap: 16px; }
    
    .deck-body {
      flex: 1; padding: 20px 24px; overflow-x: auto; 
      display: flex; gap: 16px; align-items: flex-start;
      background: #FFFFFF;
    }

    /* L2/L3 Cards */
    .l2-col {
      min-width: 220px; max-width: 240px;
      background: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 6px;
      display: flex; flex-direction: column;
      flex-shrink: 0;
    }
    .l2-head {
      padding: 10px; background: #FFF; border-bottom: 2px solid var(--dhl-yellow);
      font-size: 11px; font-weight: 700; color: #0F172A;
      border-radius: 6px 6px 0 0;
    }
    .l3-list { padding: 8px; display: flex; flex-direction: column; gap: 4px; }
    .l3-item {
      font-size: 10px; padding: 4px 6px; background: white; border: 1px solid #E2E8F0; border-radius: 4px;
      color: #475569; display: flex; gap: 6px;
    }
    .l3-item::before { content: "•"; color: var(--dhl-red); font-weight: bold; }

    .close-btn { 
      background: #E2E8F0; border: none; padding: 6px 12px; border-radius: 4px; 
      font-size: 11px; font-weight: 700; cursor: pointer; color: #475569;
    }
    .close-btn:hover { background: #CBD5E1; color: #0F172A; }

    /* Empty State */
    .deck-empty { padding: 40px; text-align: center; color: #94A3B8; font-style: italic; width: 100%; }

  </style>
</head>
<body>

<header>
  <div class="brand"><span>DHL</span> eCommerce Blueprint</div>
  <div class="legend">
    <div class="legend-item"><div class="dot" style="background:var(--dhl-yellow)"></div> Commercial</div>
    <div class="legend-item"><div class="dot" style="background:#2563EB"></div> Visibility</div>
    <div class="legend-item"><div class="dot" style="background:#F97316"></div> Resolution</div>
    <div class="legend-item"><div class="dot" style="background:var(--dhl-red)"></div> Ops</div>
  </div>
</header>

<div class="grid-wrapper" id="grid">
  </div>

<div id="deck">
  <div class="deck-header">
    <div>
      <div style="font-size:10px; font-weight:700; color:#94A3B8; margin-bottom:2px">SELECTED PROCESS</div>
      <div class="deck-title" id="d_title">Select a Process</div>
    </div>
    <div class="deck-meta">
      <span id="d_id">ID: -</span>
      <span id="d_owner">Owner: -</span>
    </div>
    <button class="close-btn" onclick="closeDeck()">CLOSE PANEL</button>
  </div>
  <div class="deck-body" id="d_body">
    <div class="deck-empty">Click any process tile above to view Level 2 steps & Level 3 activities here.</div>
  </div>
</div>

<script>
  // 1. DATA CONFIGURATION
  const STAGES = [
    { id: "S1", name: "Awareness & Plan", voice: "I discover" },
    { id: "S2", name: "Offer & Account",  voice: "I get a quote" },
    { id: "S3", name: "Onboard & Book",   voice: "I book" },
    { id: "S4", name: "Export & Transit", voice: "It moves" },
    { id: "S5", name: "Import & Arrive",  voice: "It arrives" },
    { id: "S6", name: "Delivery",         voice: "I receive" },
    { id: "S7", name: "Post-Shipment",    voice: "I review" }
  ];

  // 2. GRID ROWS (Explicit)
  const ROWS = [
    { id: "COMM", name: "Commercial", desc: "Frontstage", class: "lane-comm" },
    { id: "CONT_VIS", name: "Visibility", desc: "Data Stream", class: "lane-cont" },
    { id: "CONT_RES", name: "Resolution", desc: "Care Stream", class: "lane-cont" },
    { id: "OPS", name: "Operations", desc: "Logistics", class: "lane-ops" },
    { id: "FOUND", name: "Foundation", desc: "Backstage", class: "lane-found" }
  ];

  // 3. TILE MAPPING (L1s)
  // 'span' indicates how many columns a continuous tile should take
  const TILES = [
    // S1
    { id: "S2E_01", stage: 1, row: "FOUND" },
    { id: "L2C_01", stage: 1, row: "COMM" },
    { id: "D2O_01", stage: 1, row: "FOUND" },
    
    // S2
    { id: "L2C_02", stage: 2, row: "COMM" },
    { id: "L2C_03", stage: 2, row: "COMM" },
    
    // S3
    { id: "L2C_05", stage: 3, row: "COMM" },
    { id: "O2D_01", stage: 3, row: "OPS" },
    { id: "O2D_02", stage: 3, row: "OPS" },
    
    // S4
    { id: "O2D_04", stage: 4, row: "OPS" },
    { id: "O2D_07", stage: 4, row: "OPS" },
    
    // S5
    { id: "O2D_08", stage: 5, row: "OPS" },
    { id: "GRC_02", stage: 5, row: "FOUND" },
    
    // S6
    { id: "O2D_10", stage: 6, row: "OPS" },
    { id: "O2D_11", stage: 6, row: "OPS" },
    { id: "ITF_02", stage: 6, row: "FOUND" },
    
    // S7
    { id: "L2C_06", stage: 7, row: "COMM" },
    { id: "P2R_03", stage: 7, row: "COMM" },
    { id: "O2D_12", stage: 7, row: "OPS" },

    // CONTINUOUS STREAMS (Spanning)
    // Visibility: Booking(3) -> Delivery(6) = Span 4
    { id: "L2C_08", stage: 3, row: "CONT_VIS", span: 4, label: "L2C_08: End-to-End Visibility & Tracking" },
    
    // Resolution: Transit(4) -> Post(7) = Span 4
    { id: "P2R_01", stage: 4, row: "CONT_RES", span: 4, label: "P2R_01: Network Incident Resolution" },
    
    // Omnichannel Care: S1 -> S7 = Span 7
    { id: "L2C_09", stage: 1, row: "CONT_RES", span: 7, label: "Omnichannel Customer Care (Always On)" }
  ];

  let INDEX = new Map();

  async function init() {
    renderGrid();
    try {
      const res = await fetch("data.json");
      const root = await res.json();
      buildIndex(root);
      hydrateTiles();
    } catch(e) { console.error(e); }
  }

  function buildIndex(node) {
    if(node.id) INDEX.set(node.id, node);
    if(node.children) node.children.forEach(buildIndex);
  }

  function renderGrid() {
    const grid = document.getElementById('grid');
    
    // 1. Corner
    const corner = document.createElement('div');
    corner.className = 'corner-plate';
    corner.innerHTML = `<div class="cp-title">Service<br>Blueprint</div>`;
    grid.appendChild(corner);

    // 2. Stage Headers
    STAGES.forEach(s => {
      const h = document.createElement('div');
      h.className = 'stage-head';
      h.innerHTML = `
        <div class="stage-meta">Step ${s.num}</div>
        <div class="stage-voice">"${s.voice}"</div>
      `;
      grid.appendChild(h);
    });

    // 3. Rows & Cells
    // We render explicit cells, but allow tiles to span multiple cells via grid-column
    ROWS.forEach((r, rIdx) => {
       // Row Label
       const lab = document.createElement('div');
       lab.className = `lane-label ${r.class}`;
       lab.style.gridRow = rIdx + 2; // +2 because row 1 is headers
       lab.gridColumn = 1;
       lab.innerHTML = `<div class="lane-title">${r.name}</div><div class="lane-desc">${r.desc}</div>`;
       grid.appendChild(lab);

       // Create a container for the row track to hold cells
       // Actually, we just create cells for each stage in this row
       STAGES.forEach((s, sIdx) => {
         const cell = document.createElement('div');
         cell.className = `cell ${r.id === 'FOUND' ? 'cell-found' : ''}`;
         if(r.id.startsWith('CONT')) cell.classList.add('cell-cont');
         
         cell.style.gridRow = rIdx + 2;
         cell.style.gridColumn = sIdx + 2; // +2 because col 1 is label
         cell.id = `cell_${r.id}_${sIdx+1}`; // 1-based index
         grid.appendChild(cell);
       });
    });
  }

  function hydrateTiles() {
    TILES.forEach(t => {
      // Find parent cell
      // Note: If it spans, we put it in the start cell and style it to break out
      // BUT for CSS Grid cleaner approach: we place the tile directly in grid?
      // No, let's keep it simple: Place in start cell, use absolute width or flex grow?
      // Better: CSS Grid Item placement.
      
      const node = INDEX.get(t.id);
      const name = t.label || (node ? (node.name.includes(':') ? node.name.split(':')[1].trim() : node.name) : t.id);
      const l0 = t.id.split('_')[0];
      
      const el = document.createElement('div');
      el.onclick = () => openDeck(t.id, name);
      
      if(t.span) {
        // Continuous Stream Item
        // We need to target the grid area directly
        el.className = `tile-span c-${l0}`;
        el.innerHTML = `<span class="t-name">${name}</span>`;
        
        // Find row index
        const rIdx = ROWS.findIndex(r => r.id === t.row) + 2;
        const cStart = t.stage + 1;
        const cEnd = cStart + t.span;
        
        el.style.gridRow = rIdx;
        el.style.gridColumn = `${cStart} / ${cEnd}`;
        el.style.alignSelf = "center";
        el.style.zIndex = 10;
        
        document.getElementById('grid').appendChild(el); // Append to grid directly
        
      } else {
        // Standard Tile
        el.className = `tile c-${l0}`;
        const owner = node ? (node.owner || "Ops") : "-";
        el.innerHTML = `
          <div class="t-head"><span class="t-id">${t.id}</span><span class="t-owner">${owner}</span></div>
          <div class="t-name">${name}</div>
        `;
        document.getElementById(`cell_${t.row}_${t.stage}`).appendChild(el);
      }
    });
  }

  function openDeck(id, name) {
    const node = INDEX.get(id);
    document.getElementById('d_title').textContent = name;
    document.getElementById('d_id').textContent = "ID: " + id;
    document.getElementById('d_owner').textContent = "Owner: " + (node ? (node.owner || "TBD") : "TBD");
    
    // Highlight Active
    document.querySelectorAll('.tile, .tile-span').forEach(el => el.classList.remove('active'));
    // (Identifying the clicked element strictly is hard here without passing 'this', but visual feedback in deck is enough)

    const body = document.getElementById('d_body');
    body.innerHTML = "";

    if(!node || !node.children || node.children.length === 0) {
      body.innerHTML = `<div class="deck-empty">No Level 2 sub-processes found for this item.</div>`;
    } else {
      // Render Columns
      node.children.forEach(l2 => {
        const col = document.createElement('div');
        col.className = 'l2-col';
        const l2Name = l2.name.includes(':') ? l2.name.split(':')[1].trim() : l2.name;
        
        let l3HTML = "";
        if(l2.children && l2.children.length > 0) {
           l2.children.forEach(l3 => {
             const l3Name = l3.name.includes(':') ? l3.name.split(':')[1].trim() : l3.name;
             l3HTML += `<div class="l3-item">${l3Name}</div>`;
           });
        } else {
           l3HTML = `<div class="l3-item" style="color:#ccc; font-style:italic">No L3 activities</div>`;
        }

        col.innerHTML = `
          <div class="l2-head">${l2Name}</div>
          <div class="l3-list">${l3HTML}</div>
        `;
        body.appendChild(col);
      });
    }

    document.getElementById('deck').classList.add('open');
  }

  function closeDeck() {
    document.getElementById('deck').classList.remove('open');
  }

  init();
</script>
</body>
</html>