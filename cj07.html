<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DHL eCommerce Â· Service Blueprint</title>
  <link href="https://fonts.googleapis.com/css2?family=Delivery:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================
       DHL THEME
       ========================= */
    :root {
      --dhl-red: #D40511;
      --dhl-yellow: #FFCC00;
      --dhl-black: #101828;
      
      --bg: #F2F4F7;
      --surface: #FFFFFF;
      --border: #E4E7EC;
      
      --head-h: 60px;
      --lane-w: 220px;
      --col-min: 200px;
      
      --deck-h: 300px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--dhl-black);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* =========================
       HEADER
       ========================= */
    header {
      height: var(--head-h);
      background: var(--dhl-red);
      color: white;
      display: flex;
      align-items: center;
      padding: 0 24px;
      justify-content: space-between;
      flex-shrink: 0;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .brand { font-family: 'Delivery', sans-serif; font-weight: 900; font-size: 20px; display: flex; align-items: center; gap: 12px; }
    .brand span { background: var(--dhl-yellow); color: var(--dhl-red); padding: 2px 8px; border-radius: 4px; font-size: 14px; }
    
    .legend { display: flex; gap: 20px; font-size: 11px; font-weight: 600; }
    .legend-item { display: flex; align-items: center; gap: 6px; color: white; }
    .dot { width: 10px; height: 10px; border-radius: 2px; background: white; }

    /* =========================
       MAIN GRID
       ========================= */
    .grid-wrapper {
      flex: 1;
      overflow: auto;
      display: grid;
      /* Lane Header + 6 Stages */
      grid-template-columns: var(--lane-w) repeat(6, minmax(var(--col-min), 1fr)); 
      grid-template-rows: auto auto auto auto auto auto; /* Header + 5 Lanes */
      background: var(--bg);
      padding-bottom: var(--deck-h); 
    }

    /* Sticky Headers */
    .corner-plate {
      position: sticky; top: 0; left: 0; z-index: 60;
      background: var(--surface); 
      border-right: 1px solid var(--border);
      border-bottom: 4px solid var(--dhl-red);
      display: flex; align-items: center; justify-content: center;
      padding: 10px; grid-row: 1; grid-column: 1;
    }
    .cp-title { font-weight: 900; font-size: 12px; color: var(--dhl-red); text-transform: uppercase; text-align: center; }

    .stage-head {
      position: sticky; top: 0; z-index: 50;
      background: var(--surface); 
      border-right: 1px solid var(--border);
      border-bottom: 4px solid var(--dhl-red);
      padding: 12px 16px; display: flex; flex-direction: column; gap: 4px;
      grid-row: 1;
    }
    .stage-title { font-size: 13px; font-weight: 800; color: var(--dhl-black); text-transform: uppercase; }
    .stage-meta { font-size: 10px; font-weight: 700; color: #94A3B8; text-transform: uppercase; }

    /* Lane Labels */
    .lane-label {
      position: sticky; left: 0; z-index: 40;
      background: var(--surface);
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 20px; display: flex; flex-direction: column; justify-content: center;
    }
    .lane-title { font-size: 14px; font-weight: 800; color: var(--dhl-black); margin-bottom: 4px; }
    .lane-desc { font-size: 10px; color: #64748B; line-height: 1.3; }
    
    /* Lane Colors */
    .lane-comm { border-left: 6px solid var(--dhl-yellow); background:#FFFBEB; }
    .lane-ops { border-left: 6px solid var(--dhl-red); background:#FEF2F2; }
    .lane-cont { border-left: 6px solid #2563EB; background:#EFF6FF; }
    .lane-found { border-left: 6px solid #475569; background:#F8FAFC; }

    /* Cells */
    .cell {
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 10px; display: flex; flex-direction: column; gap: 8px;
      min-height: 140px; background: white;
    }
    .cell-cont { background: #EFF6FF; min-height: 80px; justify-content: center; }
    .cell-found { background: #F8FAFC; }

    /* =========================
       PROCESS TILES (CHEVRON STYLE)
       ========================= */
    .tile {
      background: white;
      border: 1px solid #CBD5E1;
      border-left: 4px solid #ccc;
      /* Chevron Clip Path */
      clip-path: polygon(0% 0%, 95% 0%, 100% 50%, 95% 100%, 0% 100%);
      padding: 8px 16px 8px 10px; /* Extra padding right for arrow tip */
      cursor: pointer;
      position: relative;
      transition: all 0.15s ease;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      margin-right: -5px; /* Visual overlap for flow */
    }
    .tile:hover {
      transform: translateX(2px);
      background: #FFF7ED;
      border-color: var(--dhl-red);
      z-index: 10;
    }
    .tile.active { border-color: var(--dhl-red); background: #FFF7ED; }

    /* Spanning Tiles (Continuous) */
    .tile-span {
      height: 36px; display: flex; align-items: center; justify-content: center; gap: 10px;
      background: white; border: 1px solid #93C5FD; border-left: 5px solid #2563EB;
      box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1);
      width: 98%; margin: 0 auto;
      clip-path: polygon(0% 0%, 98% 0%, 100% 50%, 98% 100%, 0% 100%);
    }
    .tile-span:hover { background: #EFF6FF; transform: scale(1.01); }
    .tile-span .t-name { font-size: 11px; font-weight: 800; color: #1E40AF; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Tile Content */
    .t-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
    .t-id { font-size: 10px; font-weight: 800; color: #64748B; }
    .t-name { font-size: 11px; font-weight: 700; color: #0F172A; line-height: 1.2; }

    /* Color Coding */
    .c-L2C { border-left-color: var(--dhl-yellow); }
    .c-O2D { border-left-color: var(--dhl-red); }
    .c-P2R { border-left-color: #F97316; }
    .c-ITF { border-left-color: #7C3AED; }
    .c-D2O { border-left-color: #475569; }

    /* =========================
       BOTTOM DECK (DETAIL VIEW)
       ========================= */
    #deck {
      position: fixed; bottom: 0; left: 0; width: 100%; height: var(--deck-h);
      background: white; border-top: 4px solid var(--dhl-red);
      z-index: 200; box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
      display: flex; flex-direction: column;
      transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    #deck.open { transform: translateY(0); }

    .deck-header {
      padding: 10px 24px; background: #F8FAFC; border-bottom: 1px solid #E2E8F0;
      display: flex; justify-content: space-between; align-items: center;
    }
    .deck-title { font-size: 16px; font-weight: 800; color: var(--dhl-black); text-transform: uppercase; }
    .deck-meta { font-size: 11px; color: #64748B; display: flex; gap: 16px; }
    
    .deck-body {
      flex: 1; padding: 20px 24px; overflow-x: auto; 
      display: flex; gap: 16px; align-items: flex-start;
      background: #FFFFFF;
    }

    /* L2/L3 Cards */
    .l2-col {
      min-width: 240px; max-width: 260px;
      background: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 6px;
      display: flex; flex-direction: column;
      flex-shrink: 0;
    }
    .l2-head {
      padding: 8px 10px; background: #FFF; border-bottom: 2px solid var(--dhl-yellow);
      display: flex; justify-content: space-between; align-items: center;
      border-radius: 6px 6px 0 0;
    }
    .l2-id { font-size: 9px; font-weight: 800; color: #94A3B8; }
    .l2-name { font-size: 11px; font-weight: 700; color: #0F172A; }

    .l3-list { padding: 8px; display: flex; flex-direction: column; gap: 4px; }
    .l3-item {
      font-size: 10px; padding: 4px 6px; background: white; border: 1px solid #E2E8F0; border-radius: 4px;
      color: #334155; display: flex; flex-direction: column; gap: 2px;
    }
    .l3-row { display: flex; justify-content: space-between; }
    .l3-id { font-weight: 800; color: var(--dhl-red); font-size: 9px; }

    .close-btn { 
      background: #E2E8F0; border: none; padding: 6px 12px; border-radius: 4px; 
      font-size: 11px; font-weight: 700; cursor: pointer; color: #475569;
    }
    .close-btn:hover { background: #CBD5E1; color: #0F172A; }

    .deck-empty { padding: 40px; text-align: center; color: #94A3B8; font-style: italic; width: 100%; }

  </style>
</head>
<body>

<header>
  <div class="brand"><span>DHL</span> eCommerce Blueprint</div>
  <div class="legend">
    <div class="legend-item"><div class="dot" style="background:var(--dhl-yellow)"></div> Commercial</div>
    <div class="legend-item"><div class="dot" style="background:var(--dhl-red)"></div> Operations</div>
    <div class="legend-item"><div class="dot" style="background:#2563EB"></div> Visibility</div>
    <div class="legend-item"><div class="dot" style="background:#F97316"></div> Resolution</div>
  </div>
</header>

<div class="grid-wrapper" id="grid">
  </div>

<div id="deck">
  <div class="deck-header">
    <div>
      <div style="font-size:10px; font-weight:700; color:#94A3B8; margin-bottom:2px">SELECTED PROCESS</div>
      <div class="deck-title" id="d_title">Select a Process</div>
    </div>
    <div class="deck-meta">
      <span id="d_id">ID: -</span>
      <span id="d_owner">Owner: -</span>
    </div>
    <button class="close-btn" onclick="closeDeck()">CLOSE PANEL</button>
  </div>
  <div class="deck-body" id="d_body">
    <div class="deck-empty">Click any chevron tile above to see Process IDs & details.</div>
  </div>
</div>

<script>
  // 1. DATA CONFIGURATION
  // Standard Logistics Flow
  const STAGES = [
    { id: "S1", name: "Plan & Prep",    num: "01" },
    { id: "S2", name: "Book & Collect", num: "02" },
    { id: "S3", name: "Export Linehaul",num: "03" },
    { id: "S4", name: "Import Gateway", num: "04" },
    { id: "S5", name: "Last Mile",      num: "05" },
    { id: "S6", name: "Post-Delivery",  num: "06" }
  ];

  // 2. GRID ROWS (Ordered by Priority)
  const ROWS = [
    { id: "COMM", name: "Commercial", desc: "Sell & Book", class: "lane-comm" },
    { id: "OPS", name: "Operations", desc: "Move & Sort", class: "lane-ops" }, // Moved UP
    { id: "CONT_VIS", name: "Visibility", desc: "Track & Trace", class: "lane-cont" },
    { id: "CONT_RES", name: "Resolution", desc: "Incidents", class: "lane-cont" },
    { id: "FOUND", name: "Foundation", desc: "Enable", class: "lane-found" }
  ];

  // 3. TILE MAPPING (L1s)
  const TILES = [
    // --- STAGE 1: PLAN ---
    { id: "S2E_01", stage: 1, row: "FOUND" },
    { id: "L2C_01", stage: 1, row: "COMM" },
    { id: "D2O_01", stage: 1, row: "FOUND" },
    
    // --- STAGE 2: BOOK ---
    { id: "L2C_02", stage: 2, row: "COMM" },
    { id: "L2C_05", stage: 2, row: "COMM" }, // Booking
    { id: "O2D_02", stage: 2, row: "OPS" },  // Pickup
    
    // --- STAGE 3: EXPORT ---
    { id: "O2D_03", stage: 3, row: "OPS" },  // Sort
    { id: "O2D_04", stage: 3, row: "OPS" },  // Linehaul
    { id: "O2D_07", stage: 3, row: "OPS" },  // Export Custom
    
    // --- STAGE 4: IMPORT ---
    { id: "O2D_08", stage: 4, row: "OPS" },  // Gateway
    { id: "O2D_09", stage: 4, row: "OPS" },  // Deconsol
    { id: "GRC_02", stage: 4, row: "FOUND" },
    
    // --- STAGE 5: LAST MILE ---
    { id: "O2D_10", stage: 5, row: "OPS" },  // Final Del
    { id: "O2D_11", stage: 5, row: "OPS" },  // POD
    { id: "ITF_02", stage: 5, row: "FOUND" },
    
    // --- STAGE 6: POST ---
    { id: "L2C_06", stage: 6, row: "COMM" }, // Bill
    { id: "P2R_03", stage: 6, row: "COMM" }, // Claims
    { id: "O2D_12", stage: 6, row: "OPS" },  // Returns

    // CONTINUOUS STREAMS (Spanning)
    // Visibility: S2 -> S6 = Span 5
    { id: "L2C_08", stage: 2, row: "CONT_VIS", span: 5, label: "L2C_08: Continuous Visibility" },
    
    // Resolution: S3 -> S6 = Span 4
    { id: "P2R_01", stage: 3, row: "CONT_RES", span: 4, label: "P2R_01: Incident Resolution" },
  ];

  let INDEX = new Map();

  async function init() {
    renderGrid();
    try {
      const res = await fetch("data.json");
      const root = await res.json();
      buildIndex(root);
      hydrateTiles();
    } catch(e) { console.error(e); }
  }

  function buildIndex(node) {
    if(node.id) INDEX.set(node.id, node);
    if(node.children) node.children.forEach(buildIndex);
  }

  function renderGrid() {
    const grid = document.getElementById('grid');
    
    // 1. Corner
    const corner = document.createElement('div');
    corner.className = 'corner-plate';
    corner.innerHTML = `<div class="cp-title">Process<br>Flow</div>`;
    grid.appendChild(corner);

    // 2. Stage Headers
    STAGES.forEach(s => {
      const h = document.createElement('div');
      h.className = 'stage-head';
      h.style.gridColumn = parseInt(s.num) + 1; // +1 for label col
      h.innerHTML = `
        <div class="stage-meta">Step ${s.num}</div>
        <div class="stage-title">${s.name}</div>
      `;
      grid.appendChild(h);
    });

    // 3. Rows & Cells
    ROWS.forEach((r, rIdx) => {
       const rowNum = rIdx + 2; // +2 offset

       // Row Label
       const lab = document.createElement('div');
       lab.className = `lane-label ${r.class}`;
       lab.style.gridRow = rowNum;
       lab.style.gridColumn = 1;
       lab.innerHTML = `<div class="lane-title">${r.name}</div><div class="lane-desc">${r.desc}</div>`;
       grid.appendChild(lab);

       // Cells for each Stage
       STAGES.forEach((s, sIdx) => {
         const cell = document.createElement('div');
         cell.className = `cell ${r.id === 'FOUND' ? 'cell-found' : ''}`;
         if(r.id.startsWith('CONT')) cell.classList.add('cell-cont');
         
         cell.style.gridRow = rowNum;
         cell.style.gridColumn = sIdx + 2; 
         cell.id = `cell_${r.id}_${sIdx+1}`; 
         grid.appendChild(cell);
       });
    });
  }

  function hydrateTiles() {
    TILES.forEach(t => {
      const node = INDEX.get(t.id);
      const name = t.label || (node ? (node.name.includes(':') ? node.name.split(':')[1].trim() : node.name) : t.id);
      const l0 = t.id.split('_')[0];
      
      const el = document.createElement('div');
      el.onclick = () => openDeck(t.id, name);
      
      if(t.span) {
        // Continuous Stream Item
        el.className = `tile-span c-${l0}`;
        el.innerHTML = `<span class="t-name">${name}</span>`;
        
        const rIdx = ROWS.findIndex(r => r.id === t.row) + 2;
        const cStart = t.stage + 1;
        const cEnd = cStart + t.span;
        
        el.style.gridRow = rIdx;
        el.style.gridColumn = `${cStart} / ${cEnd}`;
        el.style.alignSelf = "center";
        el.style.zIndex = 10;
        
        document.getElementById('grid').appendChild(el); 
        
      } else {
        // Standard Tile
        el.className = `tile c-${l0}`;
        const owner = node ? (node.owner || "Ops") : "-";
        el.innerHTML = `
          <div class="t-head"><span class="t-id">${t.id}</span></div>
          <div class="t-name">${name}</div>
        `;
        document.getElementById(`cell_${t.row}_${t.stage}`).appendChild(el);
      }
    });
  }

  function openDeck(id, name) {
    const node = INDEX.get(id);
    document.getElementById('d_title').textContent = name;
    document.getElementById('d_id').textContent = "ID: " + id;
    document.getElementById('d_owner').textContent = "Owner: " + (node ? (node.owner || "TBD") : "TBD");
    
    const body = document.getElementById('d_body');
    body.innerHTML = "";

    if(!node || !node.children || node.children.length === 0) {
      body.innerHTML = `<div class="deck-empty">No Level 2 sub-processes found.</div>`;
    } else {
      // Render Columns
      node.children.forEach(l2 => {
        const col = document.createElement('div');
        col.className = 'l2-col';
        const l2Name = l2.name.includes(':') ? l2.name.split(':')[1].trim() : l2.name;
        
        let l3HTML = "";
        if(l2.children && l2.children.length > 0) {
           l2.children.forEach(l3 => {
             const l3Name = l3.name.includes(':') ? l3.name.split(':')[1].trim() : l3.name;
             l3HTML += `
               <div class="l3-item">
                 <div class="l3-row"><span class="l3-id">${l3.id}</span></div>
                 <div>${l3Name}</div>
               </div>`;
           });
        } else {
           l3HTML = `<div class="l3-item" style="color:#ccc; font-style:italic">No L3 activities</div>`;
        }

        col.innerHTML = `
          <div class="l2-head">
            <span class="l2-name">${l2Name}</span>
            <span class="l2-id">${l2.id}</span>
          </div>
          <div class="l3-list">${l3HTML}</div>
        `;
        body.appendChild(col);
      });
    }

    document.getElementById('deck').classList.add('open');
  }

  function closeDeck() {
    document.getElementById('deck').classList.remove('open');
  }

  init();
</script>
</body>
</html>