<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DHL eCommerce · Customer Journey View (L2C with embedded O2D)</title>

  <style>
    :root{
      --dhl-red:#D40511;
      --dhl-yellow:#FFCC00;

      --bg:#f6f6f7;
      --card:#ffffff;
      --ink:#101828;
      --muted:#667085;
      --line:#e6e8ee;

      --radius:16px;
      --shadow: 0 10px 26px rgba(0,0,0,.08);
      --shadow2: 0 16px 40px rgba(0,0,0,.10);

      --chip:#f1f3f7;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      background:linear-gradient(180deg, #fff 0%, var(--bg) 60%);
    }

    header{
      position:sticky;
      top:0;
      z-index:20;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(140%) blur(8px);
      border-bottom:1px solid var(--line);
    }

    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:14px 18px;
      max-width:1500px;
      margin:0 auto;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width:280px;
    }
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:linear-gradient(135deg, var(--dhl-red), #ff3b30);
      box-shadow:0 8px 18px rgba(212,5,17,.25);
    }
    .title{
      line-height:1.1;
    }
    .title b{display:block;font-size:14px}
    .title span{display:block;font-size:12px;color:var(--muted)}

    .search{
      flex:1;
      display:flex;
      gap:10px;
      align-items:center;
      max-width:720px;
    }
    .search input{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      outline:none;
      background:#fff;
      font-size:13px;
    }
    .search input:focus{
      border-color:rgba(212,5,17,.35);
      box-shadow:0 0 0 4px rgba(212,5,17,.10);
    }
    .pill{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      background:var(--chip);
      border:1px solid var(--line);
      color:var(--muted);
      white-space:nowrap;
    }

    main{
      max-width:1500px;
      margin:0 auto;
      padding:16px 18px 26px;
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:14px;
      align-items:start;
    }

    .canvas{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card h3{
      margin:0;
      padding:12px 14px;
      font-size:13px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card h3 .meta{color:var(--muted); font-weight:500; font-size:12px}

    .section{
      padding:12px 14px 14px;
    }

    .band{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding:10px 14px 14px;
    }

    .node{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px;
      background:#fff;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease, border-color .08s ease;
      min-width:210px;
    }
    .node:hover{
      transform:translateY(-1px);
      box-shadow:var(--shadow2);
      border-color:rgba(212,5,17,.25);
    }
    .node .k{
      font-size:11px;
      color:var(--muted);
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
    }
    .node .n{
      font-size:13px;
      font-weight:700;
      margin-top:4px;
      line-height:1.25;
    }
    .node .d{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      line-height:1.35;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border-radius:999px;
      padding:4px 8px;
      font-size:11px;
      border:1px solid var(--line);
      color:var(--muted);
      background:#fff;
      white-space:nowrap;
    }
    .tag.red{border-color:rgba(212,5,17,.25); color:var(--dhl-red)}
    .tag.yellow{border-color:rgba(255,204,0,.6); color:#8a6a00}

    .grid-journey{
      display:grid;
      grid-template-columns: 1fr 1.1fr 1fr;
      gap:12px;
    }

    .lane{
      border:1px solid var(--line);
      border-radius:16px;
      background:linear-gradient(180deg,#fff, #fbfbfd);
      overflow:hidden;
    }
    .lane .lane-h{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .lane .lane-h b{font-size:12px}
    .lane .lane-h span{font-size:11px;color:var(--muted)}
    .lane .lane-b{
      padding:10px 12px 12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .nested{
      border:1px dashed rgba(212,5,17,.25);
      border-radius:14px;
      padding:10px;
      background:rgba(212,5,17,.03);
      margin-top:6px;
    }
    .nested h4{
      margin:0 0 8px 0;
      font-size:12px;
      color:var(--dhl-red);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .nested .small{
      font-size:11px;
      color:var(--muted);
    }

    /* Right panel */
    .panel{
      position:sticky;
      top:78px;
    }
    .detail{
      padding:12px 14px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .kv{
      display:grid;
      grid-template-columns: 100px 1fr;
      gap:8px 10px;
      align-items:start;
      font-size:12px;
    }
    .kv .k{color:var(--muted)}
    .kv .v{color:var(--ink)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}

    .results{
      max-height:320px;
      overflow:auto;
      border-top:1px solid var(--line);
    }
    .result{
      padding:10px 14px;
      border-bottom:1px solid var(--line);
      cursor:pointer;
    }
    .result:hover{background:#fafbff}
    .result b{font-size:12px}
    .result div{font-size:11px;color:var(--muted); margin-top:4px; line-height:1.25}

    .hint{
      padding:10px 14px;
      font-size:12px;
      color:var(--muted);
      border-top:1px solid var(--line);
      background:#fcfcfe;
    }

    @media (max-width: 1100px){
      main{grid-template-columns: 1fr; }
      .panel{position:static}
      .grid-journey{grid-template-columns: 1fr}
      .node{min-width:unset}
      .brand{min-width:unset}
    }
  </style>
</head>
<body>

<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <b>DHL eCommerce · Customer Journey View</b>
        <span>L2C lifecycle with embedded O2D execution (powered by data.json)</span>
      </div>
    </div>

    <div class="search">
      <input id="q" placeholder="Search any process (ID, name, owner, trigger, outcome)… e.g., O2D_07_01 or credit check" />
      <span class="pill" id="stats">Loading…</span>
    </div>
  </div>
</header>

<main>
  <div class="canvas">

    <!-- Steering -->
    <section class="card" id="steering">
      <h3>
        <span>Steering & Governance (directs the journey)</span>
        <span class="meta">S2E · GRC · EA_PM</span>
      </h3>
      <div class="band" id="steeringNodes"></div>
    </section>

    <!-- Journey -->
    <section class="card">
      <h3>
        <span>Customer Journey (enterprise lifecycle view)</span>
        <span class="meta">L2C owns the promise-to-cash lifecycle</span>
      </h3>

      <div class="section">
        <div class="grid-journey">

          <div class="lane">
            <div class="lane-h">
              <b>Engage & Contract (L2C)</b>
              <span>Lead → Quote → Contract</span>
            </div>
            <div class="lane-b" id="laneEngage"></div>
          </div>

          <div class="lane">
            <div class="lane-h">
              <b>Fulfil & Deliver (O2D embedded)</b>
              <span>Pickup → Network → POD</span>
            </div>
            <div class="lane-b">
              <div class="band" id="laneFulfilTop"></div>

              <div class="nested">
                <h4>
                  <span>The “execution core” inside L2C</span>
                  <span class="small">Shown standalone in operating model, embedded here for customer view</span>
                </h4>
                <div class="band" id="laneO2D"></div>
              </div>

              <div class="nested" style="border-color: rgba(255,204,0,.7); background: rgba(255,204,0,.08);">
                <h4 style="color:#8a6a00">
                  <span>Problem-to-Resolution (conditional)</span>
                  <span class="small">Only when service deviates</span>
                </h4>
                <div class="band" id="laneP2R"></div>
              </div>
            </div>
          </div>

          <div class="lane">
            <div class="lane-h">
              <b>Bill, Collect & Close (L2C + R2R)</b>
              <span>Invoice → Cash → Reporting</span>
            </div>
            <div class="lane-b" id="laneClose"></div>
          </div>

        </div>
      </div>
    </section>

    <!-- Enablers -->
    <section class="card">
      <h3>
        <span>Enablers (shared capabilities & foundations)</span>
        <span class="meta">D2O · DA · ITF · S2P · H2R · TRF · I2P</span>
      </h3>
      <div class="band" id="enablers"></div>
      <div class="hint">
        Note: Shared capabilities (e.g., address validation / geocoding / label generation) will be mapped later as a separate capability layer across these streams.
      </div>
    </section>
  </div>

  <!-- Right panel -->
  <aside class="panel card">
    <h3>
      <span>Selected Process Detail</span>
      <span class="meta" id="selId">—</span>
    </h3>
    <div class="detail" id="detail">
      <div class="kv">
        <div class="k">Name</div><div class="v" id="d_name">Select a node</div>
        <div class="k">Owner</div><div class="v" id="d_owner">—</div>
        <div class="k">Description</div><div class="v" id="d_desc">—</div>
        <div class="k">Trigger</div><div class="v" id="d_trigger">—</div>
        <div class="k">Outcome</div><div class="v" id="d_outcome">—</div>
        <div class="k">Notes</div><div class="v" id="d_notes">—</div>
      </div>
    </div>

    <h3 style="border-top:1px solid var(--line)">
      <span>Search Results</span>
      <span class="meta" id="resCount">0</span>
    </h3>
    <div class="results" id="results"></div>
  </aside>
</main>

<script>
  // ---------- helpers ----------
  const $ = (id)=>document.getElementById(id);

  function esc(s){
    return (s ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  function textOrDash(v){ return (v && String(v).trim().length) ? v : "—"; }

  function makeNodeCard(node, extraTag){
    const div = document.createElement("div");
    div.className = "node";
    div.dataset.id = node.id;

    const idOnly = (node.id || "").trim();
    const nameShort = (node.name || "").replace(/^([A-Z0-9_]+:\s*)/,"").trim();

    div.innerHTML = `
      <div class="k">
        <span class="mono">${esc(idOnly)}</span>
        ${extraTag ? `<span class="tag ${extraTag.cls}">${esc(extraTag.txt)}</span>` : ``}
      </div>
      <div class="n">${esc(nameShort || node.name || idOnly)}</div>
      <div class="d">${esc((node.description || "").slice(0,120))}${(node.description||"").length>120 ? "…" : ""}</div>
    `;
    div.addEventListener("click", ()=>selectNode(node.id));
    return div;
  }

  // ---------- data loading ----------
  let INDEX = new Map();     // id -> node
  let ALL = [];             // all nodes flat

  function walk(node){
    if(!node) return;
    if(node.id){
      INDEX.set(node.id, node);
      ALL.push(node);
    }
    (node.children || []).forEach(walk);
  }

  async function load(){
    try{
      const res = await fetch("data.json", {cache:"no-store"});
      if(!res.ok) throw new Error("Cannot load data.json");
      const root = await res.json();
      (root.children || []).forEach(walk);

      $("stats").textContent = `${ALL.length} processes loaded`;
      renderJourney();
      bindSearch();
      // default selection: L2C or O2D if exists
      selectNode(INDEX.has("L2C") ? "L2C" : (ALL[0]?.id || ""));
    }catch(e){
      $("stats").textContent = "data.json not loaded";
      $("results").innerHTML = `<div class="hint"><b>Missing data.json</b><br/>Place <span class="mono">customer_journey.html</span> in the same folder as <span class="mono">data.json</span>.</div>`;
      console.error(e);
    }
  }

  // ---------- journey configuration ----------
  const Journey = {
    steering: ["S2E","GRC","EA_PM"],
    engage:   ["L2C_01","L2C_02","L2C_03","L2C_04"],
    fulfilTop:["L2C_05"], // order mgmt & SLA promise as entry into execution
    o2d:      ["O2D_01","O2D_02","O2D_03","O2D_04","O2D_05","O2D_06","O2D_07","O2D_08","O2D_09","O2D_10","O2D_11","O2D_12"],
    p2r:      ["P2R_01","P2R_02","P2R_03","P2R_04","P2R_05","P2R_06","P2R_07","P2R_08"],
    close:    ["L2C_06","L2C_07","L2C_08","R2R"],

    enablers: ["D2O","DA","ITF","S2P","H2R","TRF","I2P"]
  };

  function pickNodes(ids){
    return ids.map(id=>INDEX.get(id)).filter(Boolean);
  }

  function renderBand(containerId, ids, tag){
    const wrap = $(containerId);
    wrap.innerHTML = "";
    pickNodes(ids).forEach(n=>{
      wrap.appendChild(makeNodeCard(n, tag));
    });
  }

  function renderJourney(){
    renderBand("steeringNodes", Journey.steering, {txt:"Steering", cls:"yellow"});
    renderBand("laneEngage", Journey.engage, {txt:"L2C", cls:"yellow"});
    renderBand("laneFulfilTop", Journey.fulfilTop, {txt:"Promise", cls:"yellow"});
    renderBand("laneO2D", Journey.o2d, {txt:"O2D", cls:"red"});
    renderBand("laneP2R", Journey.p2r, {txt:"P2R", cls:""});
    renderBand("laneClose", Journey.close, {txt:"Close", cls:""});
    renderBand("enablers", Journey.enablers, {txt:"Enabler", cls:""});
  }

  // ---------- selection ----------
  function selectNode(id){
    const node = INDEX.get(id);
    if(!node) return;

    $("selId").textContent = id;
    $("d_name").textContent = node.name || "—";
    $("d_owner").textContent = textOrDash(node.owner);
    $("d_desc").textContent = textOrDash(node.description);
    $("d_trigger").textContent = textOrDash(node.trigger);
    $("d_outcome").textContent = textOrDash(node.outcome);
    $("d_notes").textContent = textOrDash(node.notes);

    // soft highlight: scroll into view if visible
    document.querySelectorAll(".node").forEach(el=>{
      el.style.outline = (el.dataset.id === id) ? "3px solid rgba(212,5,17,.18)" : "none";
    });
  }

  // ---------- search ----------
  function searchableText(n){
    return [
      n.id, n.name, n.description, n.owner, n.trigger, n.outcome, n.notes, n.category
    ].filter(Boolean).join(" ").toLowerCase();
  }

  function bindSearch(){
    const input = $("q");
    const results = $("results");

    const cache = new Map();
    ALL.forEach(n=>cache.set(n.id, searchableText(n)));

    function run(){
      const q = input.value.trim().toLowerCase();
      results.innerHTML = "";
      if(!q){
        $("resCount").textContent = "0";
        return;
      }
      const hits = [];
      for(const n of ALL){
        const t = cache.get(n.id) || "";
        if(t.includes(q)) hits.push(n);
        if(hits.length >= 80) break; // cap for UX
      }
      $("resCount").textContent = String(hits.length);

      hits.forEach(n=>{
        const div = document.createElement("div");
        div.className = "result";
        div.innerHTML = `<b class="mono">${esc(n.id)}</b> — ${esc((n.name||"").replace(/^([A-Z0-9_]+:\s*)/,""))}
          <div>${esc((n.owner||"").trim() ? ("Owner: "+n.owner+" · ") : "")}${esc((n.description||"").slice(0,120))}${(n.description||"").length>120?"…":""}</div>`;
        div.addEventListener("click", ()=>selectNode(n.id));
        results.appendChild(div);
      });
    }

    input.addEventListener("input", run);
  }

  load();
</script>
</body>
</html>