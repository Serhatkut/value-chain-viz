<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DHL eCommerce · Customer Journey Swimlanes (Horizontal)</title>

  <style>
    :root{
      --dhl-red:#D40511;
      --dhl-yellow:#FFCC00;

      --bg:#f6f6f7;
      --card:#ffffff;
      --ink:#101828;
      --muted:#667085;
      --line:#e6e8ee;

      --radius:16px;
      --shadow: 0 10px 26px rgba(0,0,0,.08);
      --shadow2: 0 16px 40px rgba(0,0,0,.10);

      --laneH: 118px;
      --stepW: 320px;         /* more breathing room per column */
      --gap: 14px;

      /* DHL-tint backgrounds */
      --tint-yellow: rgba(255,204,0,.14);
      --tint-red: rgba(212,5,17,.10);
      --tint-gray: rgba(16,24,40,.05);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      background:linear-gradient(180deg, #fff 0%, var(--bg) 60%);
    }

    header{
      position:sticky;
      top:0;
      z-index:30;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(140%) blur(8px);
      border-bottom:1px solid var(--line);
    }

    .topbar{
      width:100%;
      max-width:none;
      margin:0;
      padding:14px 18px;
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:space-between;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width:300px;
    }
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:linear-gradient(135deg, var(--dhl-red), #ff3b30);
      box-shadow:0 8px 18px rgba(212,5,17,.25);
    }
    .title{line-height:1.1}
    .title b{display:block;font-size:14px}
    .title span{display:block;font-size:12px;color:var(--muted)}

    .search{
      flex:1;
      display:flex;
      gap:10px;
      align-items:center;
      max-width:820px;
    }
    .search input{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      outline:none;
      background:#fff;
      font-size:13px;
    }
    .search input:focus{
      border-color:rgba(212,5,17,.35);
      box-shadow:0 0 0 4px rgba(212,5,17,.10);
    }
    .pill{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      background:#f1f3f7;
      border:1px solid var(--line);
      color:var(--muted);
      white-space:nowrap;
    }

    main{
      width:100%;
      max-width:none;        /* full width */
      margin:0;
      padding:14px 18px 22px;
      display:grid;
      grid-template-columns: 1fr 420px; /* give journey more width */
      gap:14px;
      align-items:start;
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .card h3{
      margin:0;
      padding:12px 14px;
      font-size:13px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .meta{color:var(--muted); font-weight:500; font-size:12px}

    /* Swimlane container */
    .swimwrap{
      padding:12px 12px 14px;
      background:linear-gradient(180deg,#fff,#fbfbfd);
    }

    .legend{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      padding:0 2px 10px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      border:1px solid var(--line);
      color:var(--muted);
      background:#fff;
      white-space:nowrap;
    }
    .tag.red{border-color:rgba(212,5,17,.28); color:var(--dhl-red); background:rgba(212,5,17,.07)}
    .tag.yellow{border-color:rgba(255,204,0,.75); color:#6b5200; background:rgba(255,204,0,.16)}
    .tag.gray{background:rgba(16,24,40,.06)}

    .hscroll{
      overflow:auto;
      border:1px solid var(--line);
      border-radius:16px;
      background:#fff;
      width:100%;
      max-width:none;
    }

    /* Grid: first column is lane label, rest is steps */
    .grid{
      display:grid;
      grid-template-columns: 240px repeat(var(--cols), var(--stepW));
      gap:0;
      min-width: max-content; /* prevents squeezing */
      width:max-content;
    }

    .laneLabel{
      position:sticky;
      left:0;
      z-index:10;
      background:linear-gradient(180deg,#fff,#fbfbfd);
      border-right:1px solid var(--line);
      padding:12px 12px;
      height:var(--laneH);
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
    }
    .laneLabel b{font-size:12px}
    .laneLabel span{font-size:11px; color:var(--muted); line-height:1.2}

    /* Per-lane tint (set via data-lane on lane label) */
    .laneLabel[data-lane="commercial"]{ background:linear-gradient(180deg,#fff,var(--tint-yellow)); }
    .laneLabel[data-lane="ops"]{ background:linear-gradient(180deg,#fff,var(--tint-red)); }
    .laneLabel[data-lane="finance"]{ background:linear-gradient(180deg,#fff, rgba(79,70,229,.08)); }
    .laneLabel[data-lane="p2r"]{ background:linear-gradient(180deg,#fff, rgba(249,115,22,.08)); }
    .laneLabel[data-lane="enablers"]{ background:linear-gradient(180deg,#fff,var(--tint-gray)); }

    .cell{
      border-right:1px solid var(--line);
      border-bottom:1px solid var(--line);
      height:var(--laneH);
      padding:10px 10px;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      background:#fff;
    }
    .cell[data-lane="commercial"]{ background:linear-gradient(180deg,#fff, rgba(255,204,0,.06)); }
    .cell[data-lane="ops"]{ background:linear-gradient(180deg,#fff, rgba(212,5,17,.045)); }
    .cell[data-lane="finance"]{ background:linear-gradient(180deg,#fff, rgba(79,70,229,.04)); }
    .cell[data-lane="p2r"]{ background:linear-gradient(180deg,#fff, rgba(249,115,22,.04)); }
    .cell[data-lane="enablers"]{ background:linear-gradient(180deg,#fff, rgba(16,24,40,.03)); }

    .step{
      width:100%;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .08s ease, border-color .08s ease;
      background:#fff;
      position:relative;
    }
    .step:hover{
      transform:translateY(-1px);
      box-shadow:var(--shadow2);
      border-color:rgba(212,5,17,.25);
    }

    .k{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      font-size:11px;
      color:var(--muted);
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    .n{
      margin-top:4px;
      font-size:13px;
      font-weight:800;
      line-height:1.25;
    }
    .d{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    /* arrows between steps (pure CSS) */
    .step::after{
      content:"";
      position:absolute;
      top:50%;
      right:-12px;
      width:12px;
      height:2px;
      background:rgba(16,24,40,.18);
      transform:translateY(-50%);
    }
    .step::before{
      content:"";
      position:absolute;
      top:50%;
      right:-14px;
      width:0;height:0;
      border-left:6px solid rgba(16,24,40,.25);
      border-top:4px solid transparent;
      border-bottom:4px solid transparent;
      transform:translateY(-50%);
    }
    .end .step::after, .end .step::before{display:none;}

    /* Right panel */
    .panel{
      position:sticky;
      top:78px;
    }
    .detail{
      padding:12px 14px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .kv{
      display:grid;
      grid-template-columns: 96px 1fr;
      gap:8px 10px;
      align-items:start;
      font-size:12px;
    }
    .kv .k2{color:var(--muted)}
    .kv .v2{color:var(--ink); white-space:pre-wrap}

    .results{
      max-height:320px;
      overflow:auto;
      border-top:1px solid var(--line);
    }
    .result{
      padding:10px 14px;
      border-bottom:1px solid var(--line);
      cursor:pointer;
    }
    .result:hover{background:#fafbff}
    .result b{font-size:12px}
    .result div{font-size:11px;color:var(--muted); margin-top:4px; line-height:1.25}

    .hint{
      padding:10px 14px;
      font-size:12px;
      color:var(--muted);
      border-top:1px solid var(--line);
      background:#fcfcfe;
    }

    @media (max-width: 1150px){
      main{grid-template-columns: 1fr; }
      :root{ --stepW: 300px; }
      .panel{position:static}
    }
  </style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="title">
        <b>DHL eCommerce · Customer Journey Swimlanes</b>
        <span>Horizontal customer steps with L2C + embedded O2D + payment + ticket + refund</span>
      </div>
    </div>
    <div class="search">
      <input id="q" placeholder="Search any process (ID, name, owner, trigger, outcome)… e.g., credit check, invoice, tracking" />
      <span class="pill" id="stats">Loading…</span>
    </div>
  </div>
</header>

<main>
  <section class="card">
    <h3>
      <span>Customer Journey — Horizontal Swimlanes</span>
      <span class="meta">Click a step to view Description / Trigger / Outcome / Owner / Notes</span>
    </h3>

    <div class="swimwrap">
      <div class="legend">
        <span class="tag yellow">Customer-visible journey</span>
        <span class="tag red">O2D execution</span>
        <span class="tag gray">Optional (only when needed)</span>
      </div>

      <div class="hscroll">
        <div class="grid" id="grid" style="--cols: 10;"></div>
      </div>
    </div>

    <div class="hint">
      Interpretation: **O2D is embedded inside L2C** in the customer view (fulfilment execution), but remains its own value stream in operating model.
    </div>
  </section>

  <aside class="panel card">
    <h3>
      <span>Selected Step Detail</span>
      <span class="meta" id="selId">—</span>
    </h3>

    <div class="detail">
      <div class="kv">
        <div class="k2">Name</div><div class="v2" id="d_name">Select a step</div>
        <div class="k2">Owner</div><div class="v2" id="d_owner">—</div>
        <div class="k2">Description</div><div class="v2" id="d_desc">—</div>
        <div class="k2">Trigger</div><div class="v2" id="d_trigger">—</div>
        <div class="k2">Outcome</div><div class="v2" id="d_outcome">—</div>
        <div class="k2">Notes</div><div class="v2" id="d_notes">—</div>
      </div>
    </div>

    <h3 style="border-top:1px solid var(--line)">
      <span>Search Results</span>
      <span class="meta" id="resCount">0</span>
    </h3>
    <div class="results" id="results"></div>
  </aside>
</main>

<script>
  const $ = (id)=>document.getElementById(id);

  function esc(s){
    return (s ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }
  function textOrDash(v){ return (v && String(v).trim().length) ? v : "—"; }

  let INDEX = new Map();
  let ALL = [];

  function walk(node){
    if(!node) return;
    if(node.id){
      INDEX.set(node.id, node);
      ALL.push(node);
    }
    (node.children || []).forEach(walk);
  }

  async function load(){
    try{
      const res = await fetch("data.json", {cache:"no-store"});
      if(!res.ok) throw new Error("Cannot load data.json");
      const root = await res.json();
      (root.children || []).forEach(walk);

      $("stats").textContent = `${ALL.length} processes loaded`;
      renderSwimlanes();
      bindSearch();

      // pick a sensible default
      selectNode(INDEX.has("L2C_02") ? "L2C_02" : (ALL[0]?.id || ""));
    }catch(e){
      $("stats").textContent = "data.json not loaded";
      $("results").innerHTML = `<div class="hint"><b>Missing data.json</b><br/>Place <span class="mono">customer_journey_swimlanes.html</span> in the same folder as <span class="mono">data.json</span>.</div>`;
      console.error(e);
    }
  }

  // ------------------------------------------------------------
  // HORIZONTAL CUSTOMER JOURNEY PHASES (you can tweak this later)
  // Each column is a "customer step" and each lane shows mapped processes.
  // ------------------------------------------------------------
  const Phases = [
    {
      id:"PH_01", title:"Decide & Onboard",
      customer:["Choose service / create account"],
      commercial:["L2C_01","L2C_02","L2C_03","L2C_04"],
      ops:[],
      finance:[],
      p2r:[],
      enablers:["S2E","GRC","EA_PM","DA","ITF"]
    },
    {
      id:"PH_02", title:"Create Shipment",
      customer:["Book shipment / create label"],
      commercial:["L2C_05"],
      ops:["O2D_01"],
      finance:[],
      p2r:[],
      enablers:["DA","ITF","D2O"]
    },
    {
      id:"PH_03", title:"Pickup",
      customer:["Handover parcel"],
      commercial:[],
      ops:["O2D_02"],
      finance:[],
      p2r:[],
      enablers:["D2O","ITF"]
    },
    {
      id:"PH_04", title:"Network Processing",
      customer:["In transit (network)"],
      commercial:[],
      ops:["O2D_03","O2D_04","O2D_05","O2D_06","O2D_07","O2D_08","O2D_09"],
      finance:[],
      p2r:[],
      enablers:["D2O","DA","ITF","S2P","H2R"]
    },
    {
      id:"PH_05", title:"Delivery & POD",
      customer:["Receive / pickup OOH"],
      commercial:[],
      ops:["O2D_10"],
      finance:[],
      p2r:[],
      enablers:["D2O","DA","ITF"]
    },
    {
      id:"PH_06", title:"Track & Proactive Comms",
      customer:["Track shipment / notifications"],
      commercial:["L2C_08"],
      ops:["O2D_10","O2D_11"],
      finance:[],
      p2r:["P2R_01","P2R_02"],
      enablers:["DA","ITF"]
    },
    {
      id:"PH_07", title:"Invoice & Pay",
      customer:["Invoice received / payment"],
      commercial:["L2C_06","L2C_07"],
      ops:[],
      finance:["R2R_01","R2R_02","R2R_03"],
      p2r:[],
      enablers:["DA","ITF","GRC"]
    },
    {
      id:"PH_08", title:"Ticket Resolution",
      customer:["Open ticket / case updates"],
      commercial:["L2C_08"],
      ops:["O2D_11"],
      finance:[],
      p2r:["P2R_03","P2R_04"],
      enablers:["DA","ITF","EA_PM"]
    },
    {
      id:"PH_09", title:"Credit Back / Compensation",
      customer:["Refund / compensation outcome"],
      commercial:["L2C_08"],
      ops:["O2D_11","O2D_12"],
      finance:["R2R_04","R2R_06","R2R_07"],
      p2r:["P2R_05","P2R_06","P2R_07"],
      enablers:["GRC","DA","ITF"]
    },
    {
      id:"PH_10", title:"Close & Learn",
      customer:["Case closed / feedback"],
      commercial:["L2C_08"],
      ops:["O2D_12"],
      finance:["R2R_05","R2R_07"],
      p2r:["P2R_08"],
      enablers:["EA_PM","DA","TRF","I2P"]
    }
  ];

  const Lanes = [
    {key:"customer", name:"Customer", desc:"Customer decisions, actions, touchpoints", type:"text", tag:""},
    {key:"commercial", name:"Commercial (L2C)", desc:"Lead → Quote → Contract → Order promise", type:"proc", tag:"yellow"},
    {key:"ops", name:"Operations (O2D)", desc:"Pickup → hubs/gateways → delivery/POD", type:"proc", tag:"red"},
    {key:"finance", name:"Finance (Billing/AR + R2R)", desc:"Invoice → cash → accounting/reporting", type:"proc", tag:""},
    {key:"p2r", name:"Service Recovery (P2R)", desc:"Only when issues/claims arise", type:"proc", tag:"gray"},
    {key:"enablers", name:"Enablers", desc:"D2O / DA / ITF / S2P / H2R / TRF / I2P", type:"proc", tag:""}
  ];

  function nodeCardForProcess(id, tagCls){
    const node = INDEX.get(id);
    if(!node){
      // show placeholder if the id isn't present in JSON (still useful for narrative completeness)
      const div = document.createElement("div");
      div.className = "step";
      div.dataset.id = id;
      div.innerHTML = `
        <div class="k"><span class="mono">${esc(id)}</span><span class="tag ${tagCls||""}">Not in JSON</span></div>
        <div class="n">${esc(id)}</div>
        <div class="d">This process id is referenced in the journey view but not found in data.json.</div>`;
      div.addEventListener("click", ()=>selectNode(id));
      return div;
    }

    const div = document.createElement("div");
    div.className = "step";
    div.dataset.id = id;

    const nameShort = (node.name || "").replace(/^([A-Z0-9_]+:\s*)/,"").trim();
    const owner = (node.owner || "").trim();

    div.innerHTML = `
      <div class="k">
        <span class="mono">${esc(id)}</span>
        <span class="tag ${tagCls||""}">${esc(owner ? owner : "Owner TBD")}</span>
      </div>
      <div class="n">${esc(nameShort || node.name || id)}</div>
      <div class="d">${esc((node.description || "").slice(0,95))}${(node.description||"").length>95 ? "…" : ""}</div>
    `;
    div.addEventListener("click", ()=>selectNode(id));
    return div;
  }

  function textCard(text){
    const div = document.createElement("div");
    div.className = "step";
    div.innerHTML = `
      <div class="k"><span class="mono">Customer step</span><span class="tag gray">Touchpoint</span></div>
      <div class="n">${esc(text)}</div>
      <div class="d">Customer-visible action in the journey.</div>
    `;
    div.addEventListener("click", ()=>{
      $("selId").textContent = "Customer";
      $("d_name").textContent = text;
      $("d_owner").textContent = "Customer";
      $("d_desc").textContent = "Customer-visible step / touchpoint.";
      $("d_trigger").textContent = "Phase progression";
      $("d_outcome").textContent = "Next journey step";
      $("d_notes").textContent = "This is a narrative lane, not a process object.";
      document.querySelectorAll(".step").forEach(el=>el.style.outline="none");
      div.style.outline = "3px solid rgba(212,5,17,.18)";
    });
    return div;
  }

  function renderSwimlanes(){
    const cols = Phases.length;
    const grid = $("grid");
    grid.style.setProperty("--cols", cols);
    grid.innerHTML = "";

    // Header row (sticky lane label column + phase titles across)
    // We'll implement the header as a "lane label" cell + phase cells
    // using the same grid by inserting first a header lane label and then header cells.
    // (We simulate header by reusing laneLabel styling with different content.)
    const headerLabel = document.createElement("div");
    headerLabel.className = "laneLabel";
    headerLabel.style.height = "74px";
    headerLabel.style.width = "240px";
    headerLabel.innerHTML = `<b>Journey Phases</b><span>Left → Right</span>`;
    headerLabel.style.borderBottom = "1px solid var(--line)";
    grid.appendChild(headerLabel);

    for(const ph of Phases){
      const h = document.createElement("div");
      h.className = "cell";
      h.style.height = "74px";
      h.style.alignItems = "flex-start";
      h.style.background = "linear-gradient(180deg,#fff,#fbfbfd)";
      h.innerHTML = `
        <div style="width:100%">
          <div class="k"><span class="mono">${esc(ph.id)}</span><span class="tag yellow">${esc(ph.title)}</span></div>
          <div class="d" style="margin-top:6px">Customer storyline step</div>
        </div>`;
      grid.appendChild(h);
    }

    // Lane rows
    for(const lane of Lanes){
      const lab = document.createElement("div");
      lab.className = "laneLabel";
      lab.dataset.lane = lane.key;
      lab.innerHTML = `<b>${esc(lane.name)}</b><span>${esc(lane.desc)}</span>`;
      grid.appendChild(lab);

      for(let i=0;i<Phases.length;i++){
        const ph = Phases[i];
        const cell = document.createElement("div");
        cell.className = "cell" + (i===Phases.length-1 ? " end" : "");
        cell.dataset.lane = lane.key;

        const items = ph[lane.key] || [];

        // If multiple items, show first as card and a small "stack" via multiple cards (vertical inside cell).
        const stack = document.createElement("div");
        stack.style.width = "100%";
        stack.style.display = "flex";
        stack.style.flexDirection = "column";
        stack.style.gap = "8px";

        if(lane.type === "text"){
          if(items.length){
            stack.appendChild(textCard(items[0]));
          }else{
            stack.innerHTML = `<div style="font-size:12px;color:var(--muted)">—</div>`;
          }
        }else{
          if(items.length){
            const max = 2; // keep cell tidy; can be increased
            for(const id of items.slice(0,max)){
              const tagCls =
                lane.tag === "red" ? "red" :
                lane.tag === "yellow" ? "yellow" :
                (lane.tag === "gray" ? "gray" : "");
              stack.appendChild(nodeCardForProcess(id, tagCls));
            }
            if(items.length > max){
              const more = document.createElement("div");
              more.style.fontSize = "11px";
              more.style.color = "var(--muted)";
              more.textContent = `+${items.length-max} more… (use search to jump)`;
              stack.appendChild(more);
            }
          }else{
            stack.innerHTML = `<div style="font-size:12px;color:var(--muted)">—</div>`;
          }
        }

        cell.appendChild(stack);
        grid.appendChild(cell);
      }
    }
  }

  function selectNode(id){
    const node = INDEX.get(id);
    $("selId").textContent = id;

    if(!node){
      $("d_name").textContent = id;
      $("d_owner").textContent = "—";
      $("d_desc").textContent = "This process id is referenced in the journey view but not found in data.json.";
      $("d_trigger").textContent = "—";
      $("d_outcome").textContent = "—";
      $("d_notes").textContent = "—";
      return;
    }

    $("d_name").textContent = node.name || "—";
    $("d_owner").textContent = textOrDash(node.owner);
    $("d_desc").textContent = textOrDash(node.description);
    $("d_trigger").textContent = textOrDash(node.trigger);
    $("d_outcome").textContent = textOrDash(node.outcome);
    $("d_notes").textContent = textOrDash(node.notes);

    document.querySelectorAll(".step").forEach(el=>{
      el.style.outline = (el.dataset.id === id) ? "3px solid rgba(212,5,17,.18)" : "none";
    });
  }

  // search across all nodes
  function searchableText(n){
    return [
      n.id, n.name, n.description, n.owner, n.trigger, n.outcome, n.notes, n.category
    ].filter(Boolean).join(" ").toLowerCase();
  }

  function bindSearch(){
    const input = $("q");
    const results = $("results");

    const cache = new Map();
    ALL.forEach(n=>cache.set(n.id, searchableText(n)));

    function run(){
      const q = input.value.trim().toLowerCase();
      results.innerHTML = "";
      if(!q){
        $("resCount").textContent = "0";
        return;
      }
      const hits = [];
      for(const n of ALL){
        const t = cache.get(n.id) || "";
        if(t.includes(q)) hits.push(n);
        if(hits.length >= 80) break;
      }
      $("resCount").textContent = String(hits.length);

      hits.forEach(n=>{
        const div = document.createElement("div");
        div.className = "result";
        div.innerHTML = `<b class="mono">${esc(n.id)}</b> — ${esc((n.name||"").replace(/^([A-Z0-9_]+:\s*)/,""))}
          <div>${esc((n.owner||"").trim() ? ("Owner: "+n.owner+" · ") : "")}${esc((n.description||"").slice(0,120))}${(n.description||"").length>120?"…":""}</div>`;
        div.addEventListener("click", ()=>selectNode(n.id));
        results.appendChild(div);
      });
    }

    input.addEventListener("input", run);
  }

  load();
</script>
</body>
</html>